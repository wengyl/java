<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.38" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/javabaguwen/kafka/kafka-select.html"><meta property="og:site_name" content="Java八股文网"><meta property="og:description" content="在分布式系统中，为了保证服务的高可用性和数据的一致性，选举（Election）是一个核心机制。它用于在集群中的多个节点之间选出一个具有特定职责的领导者（Leader），或者在某个资源的多个副本中选出一个主副本（Leader Replica）来负责处理读写请求。当当前的领导者或主副本失效时，系统能够自动进行新的选举，快速将职责转移到其他健康的节点上，从而..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-05-01T16:05:51.000Z"><meta property="article:author" content="Mr.Hope"><meta property="article:modified_time" content="2025-05-01T16:05:51.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"","image":[""],"dateModified":"2025-05-01T16:05:51.000Z","author":[{"@type":"Person","name":"Mr.Hope","url":"https://mister-hope.com"}]}</script><title>Java八股文网</title><meta name="description" content="在分布式系统中，为了保证服务的高可用性和数据的一致性，选举（Election）是一个核心机制。它用于在集群中的多个节点之间选出一个具有特定职责的领导者（Leader），或者在某个资源的多个副本中选出一个主副本（Leader Replica）来负责处理读写请求。当当前的领导者或主副本失效时，系统能够自动进行新的选举，快速将职责转移到其他健康的节点上，从而...">
    <link rel="preload" href="/javabaguwen/assets/style-BlxzwH3B.css" as="style"><link rel="stylesheet" href="/javabaguwen/assets/style-BlxzwH3B.css">
    <link rel="modulepreload" href="/javabaguwen/assets/app-CzKZ5RuK.js"><link rel="modulepreload" href="/javabaguwen/assets/kafka-select.html-DZ5JgX2c.js"><link rel="modulepreload" href="/javabaguwen/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/javabaguwen/assets/index.html-BIyLuIZF.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/home.html-C5FRllnR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/rabbitmq-framework.html-BJfTRdzN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/updating.html-BTqB4lev.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C8HE3sTb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BofRPUP9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-array.html-CQh2BX_6.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-listnode.html-BvccyswQ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-other.html-K02tHtJV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-sort.html-C0ujop87.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-string.html-q9_U9xvR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-tree.html-fzmi3uQe.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/AQS.html-CYJjvTlb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/AtomicInteger.html-7TMQuKsp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CountDownLatch.html-CYv1LQ1Z.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CyclicBarrier.html-dCzoFKnI.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ReentrantLock.html-DT7NPqvu.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Semaphore.html-Du-7oZ5-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Synchronized.html-CLfoofuc.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Thread.html-DKAwCMmT.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ThreadLocal.html-DOskLcBZ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ThreadPool.html-V9AKjCqz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/volatile.html-McyFZwId.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CGtdkXoz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DcfeFKU4.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/disable.html-CjEhayv1.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/encrypt.html-DyasH04g.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/layout.html-CLX-uWFx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/markdown.html-CVZwBvfb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/page.html-BEnAPjYC.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/dubbo-framework.html-DGnuTtZS.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/jvm-framework.html-wqzu3og7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BsR05xgW.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/annotation.html-DRaOvbGf.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/copy.html-nTurp9_0.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/delivery.html-87bW9ZQu.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/exception.html-ElW60mXV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/generic.html-CKmc6Kja.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/java8.html-DuspJqsS.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/proxy.html-Bj_HftOj.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/reflect.html-CpONb-0n.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ArrayBlockingQueue.html-CO-2EzLw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ArrayList.html-BonMJYMw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/BlockingQueue合集.html-DI6C5W2f.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ConcurrentHashMap.html-_TOD-950.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CopyOnWriteArrayList.html-B5zGDOwU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/DelayQueue.html-iUAKqX_T.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/HashMap.html-Cc28QPf4.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedBlockingQueue.html-C3gbP6Hy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedHashMap.html-D1iaN7fZ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedList.html-s_Gg-gJ-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/PriorityQueue.html-B75Nhyur.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Set.html-WDNqLCw9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/SynchronousQueue.html-D9kHbkxa.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/TreeMap.html-JDD-EDSl.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-framework.html-t1PB4Ym7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-message.html-CJe0pgjk.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/MySQL链路追踪.html-BnDBpO2n.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/backup.html-cIr6AxF9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/dead.html-DDinBR_w.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/engine.html-DCorJ_Si.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/explain.html-BBbXvmoq.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/framework.html-DSt6zGky.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BJ13k3j_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/lock.html-hf9PfmVp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/log.html-CP_B3iV1.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/MVCC.html-DFpZ9Xsd.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/online.html-XNa1bdSw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/optimize.html-DmAv8Wa2.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/page.html-n1_eFn8N.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/performance.html-10BbqZ0p.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/phantom.html-C71tbTxW.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/push.html-q6XvQohg.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/range.html-BZUxJlnM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/second.html-B7C_rXBU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/skip.html-DhiPjR3y.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/slow.html-Cml4t6y_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/standard.html-BgjOOG7w.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/sync.html-Dl0JIUZG.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/three.html-BV1cBk6B.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/timeout.html-D_C43jRE.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/transaction.html-BhOB1bIO.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/netty-framework.html-B-INaDy8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/mybatis-framework.html-hn-wmowB.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ShardingSphere-framework.html-ijRl8ypt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/RocketMQ-transaction.html-BCvpslaN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/rocketmq-framwork.html-Bu3WJkdY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-batch.html-CZkEnRbz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-bigkey.html-DUhEL8XR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-cache.html-OtONNZWb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-cluster.html-DXASisVt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-data.html-DrT2dBuq.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-fast.html-COH-y8uJ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-hotkey.html-Bug7S0FM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-lock.html-BpMAcuRp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-mq.html-BNQhQCLK.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-persistent.html-wZc4pSik.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-thread.html-7XZWhA7_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-transaction.html-DFFKtk5_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-annotation.html-8TpZm-ME.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-framework.html-DqY461Gt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-work.html-MrZ6RZ0c.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-eureka.html-DQqATMuM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-feign.html-dOnWbHIR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-framework.html-pCyUxtT8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-gateway.html-6yFi7TZ8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-hystrix.html-ikGPNR8A.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-ribbon.html-3CwdE5RY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-select.html-ChKzgBHi.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-zuul.html-BhCaZOhm.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-annotation.html-CxO4w72H.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-start.html-DXm_zidT.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-starter.html-Dg_Ei0cx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-what.html-BzYUyf9C.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/zookeeper-framework.html-DhcA8Ae_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-annotation.html-DhccIzq7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-bean.html-9HbZMsGo.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-depend.html-CwWmirDv.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-design.html-DPOuT1Sx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-framework.html-HsSq5DPU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-ioc-aop.html-BkFkS5_m.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-transaction.html-ClIKZH47.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C0r6933U.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/baz.html-CA5_i735.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-8CTMKBd3.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ray.html-BRNlRk6d.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-controller.html-fbsoqZpr.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-framework.html-Dra6O8Z5.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-leader.html-Do79ltBr.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-message.html-aE5Mz7vy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Arthas.html-D0D8wX0z.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CodeReview.html-r6MmZq89.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/GuavaCache.html-BxqdD_rY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/git.html-DlT79MnX.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/404.html-CNH5e1PP.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BZB_9PUz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Dpc2uxYQ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-tzWzwKAt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BROoLkQz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BJD-pPo-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C-kSMRah.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CwU0YFHN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CGuRoTHs.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-InAU6Ddc.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BhUNVG5k.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DbJ8HS_0.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Bi55j3tV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-D6bkBnce.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CC0VLLj5.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-B5y_vezN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-oHslfc13.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DthGt63M.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Dr08pODp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BLmvLduy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/giscus-1zs_z9NH.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/photoswipe.esm-DXWKOczD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/javabaguwen/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Java八股文网</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/" aria-label="项目主页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>项目主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/home.html" aria-label="Java八股文"><span class="font-icon icon fa-fw fa-sm fas fa-eight" style=""></span>Java八股文<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/interview/" aria-label="面试流程"><span class="font-icon icon fa-fw fa-sm fas fa-interview" style=""></span>面试流程<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/algo/" aria-label="算法"><span class="font-icon icon fa-fw fa-sm fas fa-algo" style=""></span>算法<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/tool/" aria-label="工具"><span class="font-icon icon fa-fw fa-sm fas fa-tool" style=""></span>工具<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/about/" aria-label="关于"><span class="font-icon icon fa-fw fa-sm fas fa-about" style=""></span>关于<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/home.html" aria-label="一、前言"><!---->一、前言<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">二、Java基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">三、Java进阶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">四、数据库</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">五、JVM</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">六、框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">七、消息队列</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!----></h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">Mr.Hope</a></span><span property="author" content="Mr.Hope"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-05-01T16:05:51.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 14 分钟</span><meta property="timeRequired" content="PT14M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<!----><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#深度解析-kafka-的两种核心选举-controller-选举与分区-leader-replica-选举">深度解析 Kafka 的两种核心选举：Controller 选举与分区 Leader Replica 选举</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#引言-分布式系统中的选举-保障高可用的关键">引言：分布式系统中的选举，保障高可用的关键</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#kafka-集群的关键角色">Kafka 集群的关键角色</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#kafka-controller-选举流程深度解析-重点">Kafka Controller 选举流程深度解析 (重点)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#kafka-分区-leader-replica-选举流程深度解析-重点">Kafka 分区 Leader Replica 选举流程深度解析 (重点)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#controller-选举与分区-leader-选举的关系">Controller 选举与分区 Leader 选举的关系</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#理解-kafka-选举流程的价值">理解 Kafka 选举流程的价值</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#kafka-选举机制为何是面试热点">Kafka 选举机制为何是面试热点</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#面试问题示例与深度解析">面试问题示例与深度解析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结">总结</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><p>在分布式系统中，为了保证服务的高可用性和数据的一致性，选举（Election）是一个核心机制。它用于在集群中的多个节点之间选出一个具有特定职责的领导者（Leader），或者在某个资源的多个副本中选出一个主副本（Leader Replica）来负责处理读写请求。当当前的领导者或主副本失效时，系统能够自动进行新的选举，快速将职责转移到其他健康的节点上，从而实现故障转移。</p><p>Apache Kafka 作为一个分布式流处理平台，也广泛应用了选举机制来管理集群和分区。其中最重要、也最常被面试官考察的两种选举是：<strong>Kafka Controller 的选举</strong>和 <strong>Kafka 分区 Leader Replica 的选举</strong>。理解这两种选举的流程和原理，是深入掌握 Kafka 内部机制、理解其高可用和元数据管理的基础。</p><p>今天，我们就来深度剖析 Kafka 中的这两种选举，揭开它们背后的神秘面纱。</p><hr><h2 id="深度解析-kafka-的两种核心选举-controller-选举与分区-leader-replica-选举" tabindex="-1"><a class="header-anchor" href="#深度解析-kafka-的两种核心选举-controller-选举与分区-leader-replica-选举"><span>深度解析 Kafka 的两种核心选举：Controller 选举与分区 Leader Replica 选举</span></a></h2><h3 id="引言-分布式系统中的选举-保障高可用的关键" tabindex="-1"><a class="header-anchor" href="#引言-分布式系统中的选举-保障高可用的关键"><span>引言：分布式系统中的选举，保障高可用的关键</span></a></h3><p>在分布式系统中，为了避免单点故障，一些重要的管理职责或数据处理入口需要能够在多个节点之间转移。选举就是实现这一目标的手段。例如：</p><ul><li><strong>集群管理：</strong> 需要一个节点作为整个集群的“大脑”，负责管理元数据、协调任务、处理节点故障等。</li><li><strong>数据副本管理：</strong> 对于具有多个副本的数据分区，需要一个副本作为 Leader 来负责处理客户端的读写请求，其他副本作为 Follower 负责同步数据。当 Leader 宕机时，需要从 Follower 中选出新的 Leader。</li></ul><p>Kafka 作为一个高度依赖协调和副本机制的分布式系统，其稳定运行离不开这两种核心选举：Controller 选举和分区 Leader Replica 选举。</p><p>理解 Kafka 选举流程的价值在于：</p><ul><li><strong>深入理解 Kafka 高可用原理：</strong> 选举是实现故障自动转移的核心。</li><li><strong>掌握 Kafka 元数据管理机制：</strong> 选举过程与 Kafka 的元数据在 Zookeeper/Kraft 中的存储和更新紧密相关。</li><li><strong>高效排查集群/分区不可用问题：</strong> 启动、宕机、网络分区等情况都可能触发选举，理解流程有助于定位问题。</li><li><strong>从容应对面试：</strong> 这两种选举是面试中考察 Kafka 底层原理的必考题。</li></ul><p>接下来，我们将分别深入这两种选举流程。</p><h3 id="kafka-集群的关键角色" tabindex="-1"><a class="header-anchor" href="#kafka-集群的关键角色"><span>Kafka 集群的关键角色</span></a></h3><p>在深入选举之前，先回顾一下 Kafka 集群中的几个关键角色：</p><ul><li><strong>Broker：</strong> Kafka 集群中的一个服务器节点。一个集群由多个 Broker 组成。</li><li><strong>Zookeeper (或 Kraft)：</strong> Kafka 集群的协调服务。在 Kafka 较早版本中，Zookeeper 负责存储 Kafka 集群的元数据（Broker 信息、Topic 配置、分区状态、Consumer Group 元数据等）和协调分布式操作（如 Leader 选举）。在 Kafka 新版本中，Kafka 正在逐步移除对 Zookeeper 的依赖，转而使用 Kafka Raft (Kraft) 协议实现自身的元数据管理和选举。<strong>本文将分别介绍基于 Zookeeper 和 Kraft 的 Controller 选举。</strong></li><li><strong>Controller：</strong> Kafka 集群中<strong>唯一</strong>一个具有特殊管理职责的 Broker。它是整个集群的“大脑”或“协调者”。</li></ul><h3 id="kafka-controller-选举流程深度解析-重点" tabindex="-1"><a class="header-anchor" href="#kafka-controller-选举流程深度解析-重点"><span>Kafka Controller 选举流程深度解析 (重点)</span></a></h3><p>在任何时刻，Kafka 集群中只能有一个 Broker 充当 Controller 的角色。这个 Controller 负责整个集群范围内的管理任务。</p><ul><li><strong>Controller 的作用与重要性：</strong><ul><li><strong>管理分区状态：</strong> 负责监听 Broker 的上线/下线，当 Broker 发生变化时，触发受影响分区的 Leader 选举和副本状态更新。</li><li><strong>处理 Topic 和分区：</strong> 负责处理 Topic 的创建、删除、修改，以及分区的重分配。</li><li><strong>管理 ISR (In-Sync Replicas) 列表：</strong> 负责维护每个分区的 ISR 列表，并在副本同步状态变化时更新。</li><li><strong>与所有 Broker 通信：</strong> Controller 会与集群中的所有 Broker 建立连接，并将集群的元数据变化广播给它们。</li></ul></li></ul><p>Controller 的重要性不言而喻，它是保障 Kafka 集群稳定性和一致性的核心。如果 Controller 宕机，集群将无法进行元数据变更（如新建 Topic、分区重分配），也无法在 Leader 副本宕机时及时选举新的 Leader，影响服务可用性。因此，Controller 也必须具备故障转移能力，需要通过选举机制来保证其高可用。</p><h4 id="controller-选举机制-基于-zookeeper-或-kraft" tabindex="-1"><a class="header-anchor" href="#controller-选举机制-基于-zookeeper-或-kraft"><span>Controller 选举机制 (基于 ZooKeeper 或 Kraft)</span></a></h4><p>Controller 选举的目的是从所有可用的 Broker 中选出一个 Leader Controller。</p><ul><li><p><strong>基于 ZooKeeper (老版本 Kafka)：</strong></p><ul><li><strong>原理：</strong> 利用 Zookeeper 的<strong>临时节点 (Ephemeral ZNode)</strong> 和 <strong>Watch (监听器)</strong> 机制。</li><li><strong>选举过程：</strong><ol><li>所有 Broker 启动时，都会尝试在 Zookeeper 中创建同一个特定的<strong>临时节点</strong>，例如 <code>/controller</code>。</li><li>Zookeeper 保证在同一路径下<strong>只能成功创建一个临时节点</strong>。第一个成功创建 <code>/controller</code> 节点的 Broker 将成为当前的 Controller。</li><li>其他未能成功创建 <code>/controller</code> 节点的 Broker，都会对这个节点注册一个 <strong>Watch</strong>。</li><li>当前 Controller Broker 在正常运行时，会持续与 Zookeeper 保持心跳，维护其临时节点的存活。</li><li><strong>触发时机：</strong><ul><li><strong>集群启动时：</strong> 所有 Broker 竞争创建 <code>/controller</code> 节点。</li><li><strong>当前 Controller 宕机：</strong> 当前 Controller 与 Zookeeper 的 Session 会话超时，Zookeeper 会自动删除 <code>/controller</code> 这个临时节点。</li><li><strong>当前 Controller 主动下线：</strong> Controller 在关闭前会删除 <code>/controller</code> 节点。</li></ul></li><li><strong>重新选举：</strong> 当 <code>/controller</code> 节点被删除时，之前注册了 Watch 的其他 Broker 会收到 Zookeeper 的通知。它们会再次竞争去创建 <code>/controller</code> 临时节点，重复步骤 2 和 3，直到选出新的 Controller。</li></ol></li><li><strong>关联概念：</strong> 这个过程巧妙地利用了 Zookeeper <strong>临时节点的生命周期与客户端 Session 绑定</strong>以及 Zookeeper <strong>保证 ZNode 创建的原子性</strong>和 <strong>Watch 的事件通知机制</strong>，实现了分布式环境下的 Leader 选举。</li></ul></li><li><p><strong>基于 Kraft (新版本 Kafka)：</strong></p><ul><li><strong>原理：</strong> Kraft 是 Kafka 社区为取代 Zookeeper 而引入的<strong>基于 Raft 协议</strong>的元数据管理系统。在 Kraft 模式下，Broker 可以同时承担数据存储和元数据管理的角色。</li><li><strong>选举过程：</strong> 在一个配置为 Kraft 模式的 Kafka 集群中，会有一部分 Broker 被指定为 <strong>Controller Quorum</strong> (控制器仲裁集)。这些 Broker 会通过 Raft 协议自身进行 Leader 选举，选出一个 <strong>Controller Leader</strong>。这个 Leader 负责管理集群的元数据和协调任务，类似于 Zookeeper 模式下的 Controller。其他 Controller Quorum 成员和普通的 Broker 则从 Controller Leader 同步元数据。</li><li><strong>优势：</strong> 移除了对外部协调服务 Zookeeper 的依赖，简化了部署和运维。</li></ul></li></ul><h4 id="为什么集群中只有一个-controller" tabindex="-1"><a class="header-anchor" href="#为什么集群中只有一个-controller"><span>为什么集群中只有一个 Controller？</span></a></h4><p>只有一个 Controller 是为了简化整个集群的元数据管理和状态协调。如果允许多个 Controller 存在，它们之间的状态同步和冲突解决将变得异常复杂，容易导致<strong>脑裂 (Split-brain)</strong> 问题，从而破坏集群的一致性。由一个中心化的 Controller 处理所有集群范围的元数据变更，并通过 ZAB 或 Raft 协议广播给其他节点，是保证元数据一致性的有效手段。</p><h3 id="kafka-分区-leader-replica-选举流程深度解析-重点" tabindex="-1"><a class="header-anchor" href="#kafka-分区-leader-replica-选举流程深度解析-重点"><span>Kafka 分区 Leader Replica 选举流程深度解析 (重点)</span></a></h3><p>每个 Topic 的每个分区都有多个副本 (Replica)，其中一个副本是 Leader，负责处理该分区的读写请求。其他副本是 Follower，负责从 Leader 同步数据。当某个分区的 Leader 副本所在的 Broker 宕机或该 Leader 副本出现故障时，就需要从该分区的 Follower 副本中选举一个新的 Leader 来接替职责，保证该分区的可用性。</p><ul><li><strong>为什么需要分区 Leader 选举？</strong><ul><li><strong>高可用：</strong> Leader 副本是处理客户端请求的唯一入口。Leader 宕机将导致该分区不可用，分区 Leader 选举确保了在 Leader 故障时能够快速切换到其他副本，恢复服务。</li><li><strong>负载分担：</strong> 理论上，一个 Broker 可以是多个分区的 Leader，也可以是其他分区的 Follower。Leader 的分布影响集群的整体负载。</li></ul></li></ul><h4 id="分区-leader-replica-选举机制-由-controller-协调" tabindex="-1"><a class="header-anchor" href="#分区-leader-replica-选举机制-由-controller-协调"><span>分区 Leader Replica 选举机制 (由 Controller 协调)</span></a></h4><p>分区 Leader 选举不像 Controller 选举那样需要所有 Broker 都参与竞争。它是一个<strong>由 Controller 协调和管理的</strong>过程。</p><ul><li><strong>选举主体：</strong> <strong>Kafka Controller</strong> 是分区 Leader 选举的发起者和协调者。</li><li><strong>选举过程：</strong><ol><li><strong>触发时机：</strong><ul><li><strong>原 Leader 副本所在的 Broker 宕机：</strong> Controller 会收到该 Broker 失效的通知。</li><li><strong>原 Leader 副本故障：</strong> Leader 副本自身发生异常，无法继续服务。</li><li><strong>Controller 发生变化：</strong> 新的 Controller 选举成功后，它会负责接管所有分区的管理权，并可能触发一次全量的分区状态检查和必要的 Leader 选举。</li><li><strong>分区重分配完成：</strong> 当通过管理工具触发了分区重分配任务并完成后，Controller 会为相关分区选举新的 Leader。</li></ul></li><li><strong>Controller 检测故障：</strong> Controller 持续监听 Broker 的状态。当检测到某个 Broker 宕机时，Controller 会识别出该 Broker 上担任 Leader 副本的所有分区。</li><li><strong>从 ISR 中选择新 Leader：</strong> 对于每个失去 Leader 的分区，Controller 会从该分区的 <strong>ISR (In-Sync Replicas)</strong> 集合中选择一个健康的 Follower 副本作为新的 Leader。ISR 是指与原 Leader 副本保持同步的 Follower 副本集合。</li><li><strong>更新元数据并广播：</strong> Controller 更新 Zookeeper (或 Kraft) 中该分区的元数据信息（指定新的 Leader，更新 ISR 列表）。然后将这个变更通过内部通信机制广播给集群中的所有 Broker。</li><li><strong>Broker 响应：</strong> 相关的 Broker 收到元数据更新通知后，新的 Leader 副本开始对外提供服务，其他副本继续作为 Follower 从新的 Leader 同步数据。</li></ol></li></ul><h4 id="isr-in-sync-replicas-的重要性" tabindex="-1"><a class="header-anchor" href="#isr-in-sync-replicas-的重要性"><span>ISR (In-Sync Replicas) 的重要性</span></a></h4><ul><li><strong>定义：</strong> ISR 是指当前与分区的 Leader 副本保持<strong>完全同步</strong>的 Follower 副本集合（包括 Leader 副本自身）。“同步”通常指 Follower 副本的消息日志偏移量与 Leader 副本相差在配置的阈值以内。</li><li><strong>作用：</strong> ISR 集合是保证 Kafka 数据不丢失和高可用性的核心。 <ul><li><strong>数据一致性：</strong> 生产者发送消息时，如果配置 <code>acks=all</code> (或 <code>acks=-1</code>)，只有当 Leader 副本将消息写入本地日志，并且 ISR 中的所有 Follower 副本也都成功复制并写入本地日志后，Leader 才会向生产者发送确认。这保证了在 ISR 中的任何一个副本宕机时，该副本中的所有已提交消息（已收到生产者确认的消息）在其他 ISR 副本中都有备份，不会丢失。</li><li><strong>Leader 选举资格：</strong> <strong>只有在 ISR 中的副本才有资格被选为新的 Leader。</strong> 这样做是为了确保新选出的 Leader 拥有所有已提交的消息，防止因选举了一个数据落后的 Follower 导致数据丢失。</li></ul></li></ul><h4 id="unclean-leader-election-非干净-leader-选举" tabindex="-1"><a class="header-anchor" href="#unclean-leader-election-非干净-leader-选举"><span>Unclean Leader Election (非干净 Leader 选举)</span></a></h4><ul><li><strong>概念：</strong> 在极端情况下，如果一个分区的 Leader 副本所在的 Broker 宕机，<strong>并且该分区的 ISR 集合中已经没有可用的 Follower 副本</strong>（例如，所有 Follower 副本都落后太多或都宕机了），此时默认情况下该分区将处于不可用状态，直到有 ISR 中的副本恢复。为了提高可用性，Kafka 提供了一个配置 <code>unclean.leader.election.enable</code> (默认为 false)。如果将其设置为 true，则允许在 ISR 中没有可用副本的情况下，从所有 Follower 副本中（包括那些数据落后的 Follower）选举一个新的 Leader。</li><li><strong>风险与权衡：</strong> 开启非干净 Leader 选举会提高分区的可用性（即使所有 ISR 副本都不可用，也能选出 Leader），但<strong>存在数据丢失的风险</strong>，因为新的 Leader 可能不包含原 Leader 已提交的所有消息。这是一种在<strong>一致性</strong>和<strong>可用性</strong>之间的权衡。</li></ul><h3 id="controller-选举与分区-leader-选举的关系" tabindex="-1"><a class="header-anchor" href="#controller-选举与分区-leader-选举的关系"><span>Controller 选举与分区 Leader 选举的关系</span></a></h3><p>两者是紧密关联但职责不同的选举：</p><ul><li><strong>Controller 选举：</strong> 是整个 Kafka 集群级别的选举，发生在集群启动或原 Controller 宕机时。选举出的 Controller 是整个集群的“大脑”，负责管理和协调。</li><li><strong>分区 Leader 选举：</strong> 是针对<strong>某个特定分区</strong>的选举，发生在某个分区的 Leader 副本宕机时。这个选举过程<strong>由当前集群的 Controller 负责协调和执行</strong>。Controller 接收到 Leader 宕机的通知后，负责选择新的 Leader 并更新元数据。</li></ul><p>简单来说，Controller 选举是“选出管事的人”，而分区 Leader 选举是“由管事的人决定每个分区谁来负责读写”。Controller 选举先发生，且选出的 Controller 是后续所有分区 Leader 选举的协调者。</p><h3 id="理解-kafka-选举流程的价值" tabindex="-1"><a class="header-anchor" href="#理解-kafka-选举流程的价值"><span>理解 Kafka 选举流程的价值</span></a></h3><ul><li><strong>深入理解 Kafka HA 原理：</strong> 选举是 Kafka 实现故障自动转移的核心机制。</li><li><strong>高效排查集群/分区问题：</strong> 启动时某个分区不可用？Broker 宕机后分区没恢复？这些问题常常与选举过程相关，理解流程有助于定位是 Controller 选举失败、分区 Leader 选举失败、ISR 不足还是元数据问题。</li><li><strong>理解元数据管理：</strong> 选举过程伴随着 Zookeeper/Kraft 中元数据的读写和更新。</li><li><strong>应对面试：</strong> 这两种选举是面试中考察 Kafka 底层机制和分布式原理的必考点。</li></ul><h3 id="kafka-选举机制为何是面试热点" tabindex="-1"><a class="header-anchor" href="#kafka-选举机制为何是面试热点"><span>Kafka 选举机制为何是面试热点</span></a></h3><ul><li><strong>分布式系统的核心：</strong> 选举是分布式环境下高可用和协调的基础。</li><li><strong>Kafka 内部关键机制：</strong> 它不是表层功能，而是 Kafka 稳定运行的基石。</li><li><strong>涉及重要概念：</strong> 考察选举必然会关联到 Controller、分区、副本、ISR、Zookeeper/Kraft 等关键概念。</li><li><strong>原理性问题：</strong> 对 Zookeeper 机制、ZAB 协议、Raft 协议、CAP 理论等分布式原理的实践应用。</li></ul><h3 id="面试问题示例与深度解析" tabindex="-1"><a class="header-anchor" href="#面试问题示例与深度解析"><span>面试问题示例与深度解析</span></a></h3><ul><li><strong>什么是 Kafka Controller？它在 Kafka 集群中有什么作用？为什么集群中只能有一个 Controller？</strong> (定义为集群大脑，列举职责，解释单 Controller 为了简化元数据管理和避免脑裂)</li><li><strong>请描述一下 Kafka Controller 的选举流程。基于 ZooKeeper 的选举原理是什么？基于 Kraft 呢？</strong> (<strong>核心！</strong> ZK: 竞争创建临时节点，Watch 机制，失败重试。Kraft: Raft 协议自身选举 Controller Leader。说明两者区别)</li><li><strong>请描述一下 Kafka 分区 Leader Replica 的选举流程。这个选举是由谁来协调的？</strong> (<strong>核心！</strong> 由 Controller 协调执行。Controller 检测 Leader 宕机 -&gt; 从 ISR 中选新 Leader -&gt; 更新元数据 -&gt; 广播)</li><li><strong>为什么分区 Leader 选举必须从 ISR (In-Sync Replicas) 中选择新的 Leader？ISR 的作用是什么？</strong> (<strong>核心！</strong> ISR 定义，作用：保证已提交数据不丢失，确保新 Leader 拥有最新数据，是 Leader 选举的资格集合)</li><li><strong>什么是 Unclean Leader Election (非干净 Leader 选举)？它有什么风险？</strong> (定义：ISR 无可用副本时从非 ISR 副本选 Leader。风险：可能丢失数据)</li><li><strong>Kafka Controller 选举和分区 Leader 选举有什么关系？它们哪个先发生？</strong> (关系：Controller 选举先发生，选出的 Controller 负责协调所有分区 Leader 选举)</li><li><strong>Kafka 如何处理 Controller 宕机？如何处理分区 Leader 宕机？</strong> (Controller 宕机触发 Controller 选举；分区 Leader 宕机由 Controller 协调分区 Leader 选举)</li><li><strong>如果一个 Follower 副本长时间没有向 Leader 同步数据，会发生什么？</strong> (它可能被移出 ISR 集合，失去参与 Leader 选举的资格)</li></ul><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>Kafka 集群的稳定运行和高可用性，离不开其精心设计的选举机制。<strong>Controller 选举</strong>负责从所有 Broker 中选出唯一的集群管理者，保证集群元数据的一致性；而<strong>分区 Leader Replica 选举</strong>则由 Controller 协调执行，确保在 Leader 副本宕机时，能够从 <strong>ISR (In-Sync Replicas)</strong> 中快速选出新的 Leader，保障分区的可用性，并结合 <code>acks</code> 参数保证已提交数据的持久性。</p><p>理解 Controller 基于 Zookeeper (临时节点+Watch) 或 Kraft (Raft 协议) 的选举原理、分区 Leader 选举由 Controller 协调并强制从 ISR 中选择的机制、以及 ISR 在保证一致性和高可用中的关键作用，是深入掌握 Kafka 内部机制的核心。</p></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/kafka/kafka-select.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: oointer@163.com">Yideng</span><!--]--><!--]--></div></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2025 Mr.Hope </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/javabaguwen/assets/app-CzKZ5RuK.js" defer></script>
  </body>
</html>
