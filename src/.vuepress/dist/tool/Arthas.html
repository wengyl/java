<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.38" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/javabaguwen/tool/Arthas.html"><meta property="og:site_name" content="Java八股文网"><meta property="og:description" content="Arthas深度解析：Java线上诊断的利器与原理实战 在复杂的微服务架构和高并发的线上系统中，Java应用的稳定性与性能是保障业务连续性的基石。然而，线上环境瞬息万变，各种疑难杂症层出不穷：CPU突然飙高、接口响应变慢、类加载冲突、代码死锁、内存泄露……面对这些问题，传统的日志分析、远程Debug往往显得力不从心，甚至难以复现。 正是在这样的背景下，..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-05-01T16:05:51.000Z"><meta property="article:author" content="Mr.Hope"><meta property="article:modified_time" content="2025-05-01T16:05:51.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"","image":[""],"dateModified":"2025-05-01T16:05:51.000Z","author":[{"@type":"Person","name":"Mr.Hope","url":"https://mister-hope.com"}]}</script><title>Java八股文网</title><meta name="description" content="Arthas深度解析：Java线上诊断的利器与原理实战 在复杂的微服务架构和高并发的线上系统中，Java应用的稳定性与性能是保障业务连续性的基石。然而，线上环境瞬息万变，各种疑难杂症层出不穷：CPU突然飙高、接口响应变慢、类加载冲突、代码死锁、内存泄露……面对这些问题，传统的日志分析、远程Debug往往显得力不从心，甚至难以复现。 正是在这样的背景下，...">
    <link rel="preload" href="/javabaguwen/assets/style-BlxzwH3B.css" as="style"><link rel="stylesheet" href="/javabaguwen/assets/style-BlxzwH3B.css">
    <link rel="modulepreload" href="/javabaguwen/assets/app-CzKZ5RuK.js"><link rel="modulepreload" href="/javabaguwen/assets/Arthas.html-D0D8wX0z.js"><link rel="modulepreload" href="/javabaguwen/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/javabaguwen/assets/index.html-BIyLuIZF.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/home.html-C5FRllnR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/rabbitmq-framework.html-BJfTRdzN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/updating.html-BTqB4lev.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C8HE3sTb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BofRPUP9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-array.html-CQh2BX_6.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-listnode.html-BvccyswQ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-other.html-K02tHtJV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-sort.html-C0ujop87.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-string.html-q9_U9xvR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-tree.html-fzmi3uQe.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/AQS.html-CYJjvTlb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/AtomicInteger.html-7TMQuKsp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CountDownLatch.html-CYv1LQ1Z.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CyclicBarrier.html-dCzoFKnI.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ReentrantLock.html-DT7NPqvu.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Semaphore.html-Du-7oZ5-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Synchronized.html-CLfoofuc.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Thread.html-DKAwCMmT.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ThreadLocal.html-DOskLcBZ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ThreadPool.html-V9AKjCqz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/volatile.html-McyFZwId.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CGtdkXoz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DcfeFKU4.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/disable.html-CjEhayv1.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/encrypt.html-DyasH04g.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/layout.html-CLX-uWFx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/markdown.html-CVZwBvfb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/page.html-BEnAPjYC.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/dubbo-framework.html-DGnuTtZS.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/jvm-framework.html-wqzu3og7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BsR05xgW.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/annotation.html-DRaOvbGf.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/copy.html-nTurp9_0.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/delivery.html-87bW9ZQu.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/exception.html-ElW60mXV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/generic.html-CKmc6Kja.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/java8.html-DuspJqsS.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/proxy.html-Bj_HftOj.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/reflect.html-CpONb-0n.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ArrayBlockingQueue.html-CO-2EzLw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ArrayList.html-BonMJYMw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/BlockingQueue合集.html-DI6C5W2f.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ConcurrentHashMap.html-_TOD-950.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CopyOnWriteArrayList.html-B5zGDOwU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/DelayQueue.html-iUAKqX_T.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/HashMap.html-Cc28QPf4.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedBlockingQueue.html-C3gbP6Hy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedHashMap.html-D1iaN7fZ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedList.html-s_Gg-gJ-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/PriorityQueue.html-B75Nhyur.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Set.html-WDNqLCw9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/SynchronousQueue.html-D9kHbkxa.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/TreeMap.html-JDD-EDSl.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-framework.html-t1PB4Ym7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-message.html-CJe0pgjk.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-select.html-DZ5JgX2c.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/MySQL链路追踪.html-BnDBpO2n.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/backup.html-cIr6AxF9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/dead.html-DDinBR_w.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/engine.html-DCorJ_Si.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/explain.html-BBbXvmoq.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/framework.html-DSt6zGky.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BJ13k3j_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/lock.html-hf9PfmVp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/log.html-CP_B3iV1.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/MVCC.html-DFpZ9Xsd.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/online.html-XNa1bdSw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/optimize.html-DmAv8Wa2.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/page.html-n1_eFn8N.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/performance.html-10BbqZ0p.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/phantom.html-C71tbTxW.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/push.html-q6XvQohg.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/range.html-BZUxJlnM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/second.html-B7C_rXBU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/skip.html-DhiPjR3y.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/slow.html-Cml4t6y_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/standard.html-BgjOOG7w.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/sync.html-Dl0JIUZG.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/three.html-BV1cBk6B.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/timeout.html-D_C43jRE.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/transaction.html-BhOB1bIO.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/netty-framework.html-B-INaDy8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/mybatis-framework.html-hn-wmowB.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ShardingSphere-framework.html-ijRl8ypt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/RocketMQ-transaction.html-BCvpslaN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/rocketmq-framwork.html-Bu3WJkdY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-batch.html-CZkEnRbz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-bigkey.html-DUhEL8XR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-cache.html-OtONNZWb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-cluster.html-DXASisVt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-data.html-DrT2dBuq.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-fast.html-COH-y8uJ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-hotkey.html-Bug7S0FM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-lock.html-BpMAcuRp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-mq.html-BNQhQCLK.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-persistent.html-wZc4pSik.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-thread.html-7XZWhA7_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-transaction.html-DFFKtk5_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-annotation.html-8TpZm-ME.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-framework.html-DqY461Gt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-work.html-MrZ6RZ0c.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-eureka.html-DQqATMuM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-feign.html-dOnWbHIR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-framework.html-pCyUxtT8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-gateway.html-6yFi7TZ8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-hystrix.html-ikGPNR8A.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-ribbon.html-3CwdE5RY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-select.html-ChKzgBHi.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-zuul.html-BhCaZOhm.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-annotation.html-CxO4w72H.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-start.html-DXm_zidT.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-starter.html-Dg_Ei0cx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-what.html-BzYUyf9C.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/zookeeper-framework.html-DhcA8Ae_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-annotation.html-DhccIzq7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-bean.html-9HbZMsGo.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-depend.html-CwWmirDv.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-design.html-DPOuT1Sx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-framework.html-HsSq5DPU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-ioc-aop.html-BkFkS5_m.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-transaction.html-ClIKZH47.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C0r6933U.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/baz.html-CA5_i735.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-8CTMKBd3.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ray.html-BRNlRk6d.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-controller.html-fbsoqZpr.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-framework.html-Dra6O8Z5.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-leader.html-Do79ltBr.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-message.html-aE5Mz7vy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CodeReview.html-r6MmZq89.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/GuavaCache.html-BxqdD_rY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/git.html-DlT79MnX.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/404.html-CNH5e1PP.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BZB_9PUz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Dpc2uxYQ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-tzWzwKAt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BROoLkQz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BJD-pPo-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C-kSMRah.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CwU0YFHN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CGuRoTHs.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-InAU6Ddc.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BhUNVG5k.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DbJ8HS_0.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Bi55j3tV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-D6bkBnce.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CC0VLLj5.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-B5y_vezN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-oHslfc13.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DthGt63M.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Dr08pODp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BLmvLduy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/giscus-1zs_z9NH.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/photoswipe.esm-DXWKOczD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/javabaguwen/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Java八股文网</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/" aria-label="项目主页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>项目主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/home.html" aria-label="Java八股文"><span class="font-icon icon fa-fw fa-sm fas fa-eight" style=""></span>Java八股文<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/interview/" aria-label="面试流程"><span class="font-icon icon fa-fw fa-sm fas fa-interview" style=""></span>面试流程<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/algo/" aria-label="算法"><span class="font-icon icon fa-fw fa-sm fas fa-algo" style=""></span>算法<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link active" href="/javabaguwen/tool/" aria-label="工具"><span class="font-icon icon fa-fw fa-sm fas fa-tool" style=""></span>工具<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/about/" aria-label="关于"><span class="font-icon icon fa-fw fa-sm fas fa-about" style=""></span>关于<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">工具清单</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/tool/git.html" aria-label="Git教程"><!---->Git教程<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/tool/CodeReview.html" aria-label="CodeReview流程"><!---->CodeReview流程<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/tool/GuavaCache.html" aria-label="Guava Cache缓存"><!---->Guava Cache缓存<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/javabaguwen/tool/Arthas.html" aria-label="Arthas"><!---->Arthas<!----></a></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!----></h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">Mr.Hope</a></span><span property="author" content="Mr.Hope"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-04-29T06:25:28.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 18 分钟</span><meta property="timeRequired" content="PT18M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<!----><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#arthas深度解析-java线上诊断的利器与原理实战">Arthas深度解析：Java线上诊断的利器与原理实战</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#一、-arthas是什么-为何如此重要">一、 Arthas是什么？为何如此重要？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#二、-arthas工作原理解析-深入原理">二、 Arthas工作原理解析 (深入原理)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#三、核心命令详解与实战场景">三、核心命令详解与实战场景</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#四、-arthas的性能影响与安全性">四、 Arthas的性能影响与安全性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#五、-arthas使用最佳实践与技巧">五、 Arthas使用最佳实践与技巧</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#六、-与其他诊断工具的对比">六、 与其他诊断工具的对比</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结">总结</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h2 id="arthas深度解析-java线上诊断的利器与原理实战" tabindex="-1"><a class="header-anchor" href="#arthas深度解析-java线上诊断的利器与原理实战"><span>Arthas深度解析：Java线上诊断的利器与原理实战</span></a></h2><p>在复杂的微服务架构和高并发的线上系统中，Java应用的稳定性与性能是保障业务连续性的基石。然而，线上环境瞬息万变，各种疑难杂症层出不穷：CPU突然飙高、接口响应变慢、类加载冲突、代码死锁、内存泄露……面对这些问题，传统的日志分析、远程Debug往往显得力不从心，甚至难以复现。</p><p>正是在这样的背景下，阿里巴巴开源的<strong>Arthas</strong>（阿尔萨斯）应运而生。它是一款功能强大的Java线上监控诊断产品，允许开发者在无需修改代码、无需重启应用的情况下，实时查看JVM状态、诊断并解决各类生产问题。对于中高级Java工程师而言，掌握Arthas不仅是提升问题排查效率的必备技能，更是应对技术面试中线上问题考察的利弹。</p><h3 id="一、-arthas是什么-为何如此重要" tabindex="-1"><a class="header-anchor" href="#一、-arthas是什么-为何如此重要"><span>一、 Arthas是什么？为何如此重要？</span></a></h3><p><strong>定义：</strong> Arthas是一款基于Java Agent技术实现的，集成了多种JVM诊断工具功能的交互式命令行工具。它可以动态地 Attach 到目标JVM进程，获取运行时状态，甚至修改运行时行为。</p><p><strong>解决的核心痛点：</strong></p><ol><li><strong>问题难以复现：</strong> 很多线上问题（如特定条件下的死锁、内存泄露、并发问题）只在特定的生产环境下触发，本地或测试环境难以模拟。</li><li><strong>传统手段局限性：</strong><ul><li><strong>日志：</strong> 过度依赖日志可能导致日志泛滥或关键信息缺失；没有预埋日志的代码行为无法观察。</li><li><strong>远程Debug：</strong> 可能对线上性能影响较大，且需要开放Debug端口，存在安全风险，更重要的是会暂停线程，在高并发下几乎不可用。</li><li><strong>dump文件分析 (jstack, jmap等)：</strong> 提供了案发现场的“快照”，但无法提供动态行为信息，对偶发问题帮助有限。</li></ul></li></ol><p><strong>Arthas的核心优势：</strong></p><ul><li><strong>非侵入式：</strong> 无需修改应用代码，只需Attach到运行中的JVM进程即可。</li><li><strong>动态诊断：</strong> 实时获取JVM和应用状态，可以动态观察方法执行、变量值等。</li><li><strong>实时性：</strong> 提供秒级的实时数据和动态分析能力。</li><li><strong>丰富的功能集：</strong> 集成了线程、内存、GC、类加载、方法执行观测、热更新、OGNL表达式执行等多种强大功能于一体。</li></ul><h3 id="二、-arthas工作原理解析-深入原理" tabindex="-1"><a class="header-anchor" href="#二、-arthas工作原理解析-深入原理"><span>二、 Arthas工作原理解析 (深入原理)</span></a></h3><p>Arthas之所以能实现这些强大的功能，离不开Java底层机制的支持：</p><ol><li><p><strong>Attach 机制：</strong></p><ul><li>Arthas启动后，其核心是寻找目标JVM进程并与之建立连接。这依赖于Java的<code>Attach API</code> (位于 <code>com.sun.tools.attach</code> 包，通常在JDK的 <code>lib/tools.jar</code> 中)。</li><li>Arthas客户端通过Attach API连接到目标JVM，然后请求目标JVM加载Arthas Agent（一个jar包）。</li><li>Agent加载成功后，就在目标JVM进程内运行，并与Arthas客户端建立通信通道（通常是基于Socket）。后续所有的命令都是通过这个通道发送给Agent执行。</li></ul></li><li><p><strong>Instrumentation 技术：</strong></p><ul><li>这是Arthas实现动态代码观测（如 <code>watch</code>, <code>trace</code>, <code>monitor</code>）和热更新（<code>redefine</code>）的关键。它依赖于Java的<code>java.lang.instrument</code> 包。</li><li>Agent被加载到目标JVM后，会获得一个 <code>Instrumentation</code> 实例。这个实例允许Agent在运行时对已加载的类进行<strong>字节码修改</strong>。</li><li>Arthas底层使用了高效的字节码增强库，如 <strong>ByteBuddy</strong>（早期版本可能用Javassist），来操作字节码。</li><li>例如： <ul><li><code>watch</code> 和 <code>trace</code> 命令：在目标方法的入口、出口（正常返回、抛异常）位置插入探针（即Arthas自己的代码）。这些探针代码负责记录参数、返回值、异常、执行时间等信息，并通过通信通道发回给客户端。</li><li><code>monitor</code> 命令：插入探针，在方法执行时更新计数器、总耗时等统计信息，并周期性地上报。</li><li><code>redefine</code> 命令：利用<code>Instrumentation</code>的<code>redefineClasses()</code>方法，用新的字节码替换掉内存中的旧字节码。</li></ul></li></ul></li><li><p><strong>类加载器机制：</strong></p><ul><li>Arthas自身的Agent和命令实现类需要被目标JVM加载。为了避免与目标应用的类库发生冲突（例如，Arthas依赖的某个库与应用依赖的版本不同），Arthas Agent 使用了<strong>独立的类加载器</strong>来加载自身及所需的第三方库。这保证了Arthas的运行环境与目标应用隔离。</li><li>然而，当Arthas需要操作目标应用的类（如 <code>sc</code>, <code>jad</code>, <code>watch</code> 指定类）时，它必须能够找到并使用目标应用中的类加载器。Arthas Agent会遍历目标JVM中的所有类加载器，查找目标类，并利用相应的类加载器来完成类的查找、反编译、字节码增强等操作。<code>classloader</code> 命令就是用于帮助用户理解和排查类加载器问题的。</li></ul></li><li><p><strong>命令执行与通信：</strong></p><ul><li>Arthas采用客户端-服务端模式。客户端是你操作的Shell或Web Console。服务端是注入到目标JVM中的Agent。</li><li>你在客户端输入的命令，通过Socket连接发送给Agent。</li><li>Agent接收到命令后，解析命令，调用相应的Arthas模块执行操作（如调用Instrumentation修改字节码，或调用ManagementFactory获取JVM信息）。</li><li>执行结果通过Socket连接返回给客户端展示。</li></ul></li></ol><h3 id="三、核心命令详解与实战场景" tabindex="-1"><a class="header-anchor" href="#三、核心命令详解与实战场景"><span>三、核心命令详解与实战场景</span></a></h3><p>掌握Arthas的核心命令是解决实际问题的关键。这里结合原理和场景进行讲解。</p><h4 id="基础信息查看-快速概览与定位" tabindex="-1"><a class="header-anchor" href="#基础信息查看-快速概览与定位"><span>基础信息查看 (快速概览与定位)</span></a></h4><ul><li><strong><code>dashboard</code></strong>: 提供实时的JVM状态面板，包括线程、内存、GC、运行时信息等。 <ul><li><strong>原理：</strong> 周期性调用JVM Management Beans (<code>java.lang.management.*</code>) 获取数据。</li><li><strong>场景：</strong> 刚Attach上时的首选命令，快速了解应用整体健康状况，发现是否存在明显的内存或GC问题，线程数是否异常。</li></ul></li><li><strong><code>thread</code></strong>: 查看目标JVM内的线程信息。 <ul><li><strong>原理：</strong> 获取所有线程的StackTrace和状态。</li><li><strong>场景：</strong><ul><li><code>thread</code>: 查看所有线程，包括线程ID、状态、堆栈。</li><li><code>thread -n &lt;number&gt;</code>: 查看CPU占用率最高的几个线程。**排查CPU飙高问题的利器！**通常结合 <code>printf &quot;%x\n&quot; &lt;线程ID&gt;</code> 将十进制线程ID转为十六进制，然后在 <code>jstack &lt;PID&gt;</code> 的输出中查找对应的nid (native ID) 来确认具体是哪个业务线程或JVM内部线程导致的高CPU。</li><li><code>thread -b</code>: 查找潜在的死锁线程。<strong>排查死锁问题的利器！</strong></li></ul></li></ul></li><li><strong><code>jvm</code></strong>: 查看当前JVM进程信息。 <ul><li><strong>原理：</strong> 调用JVM Management Beans。</li><li><strong>场景：</strong> 查看JVM启动参数、运行时间、各种内存池（Eden, Old, Survivor等）的详细情况、GC次数和耗时、类加载统计等。深入了解JVM配置和运行时内存分布。</li></ul></li><li><strong><code>sysprop</code> / <code>sysenv</code></strong>: 查看System Properties / Environment Variables。 <ul><li><strong>原理：</strong> 直接访问 <code>System.getProperties()</code> 和 <code>System.getenv()</code>.</li><li><strong>场景：</strong> 确认应用获取到的配置是否正确。特别是 <code>sysprop</code> 经常用于查看 <code>-D</code> 参数传递的属性。</li></ul></li><li><strong><code>getstatic</code></strong>: 查看类的静态字段值。 <ul><li><strong>原理：</strong> 通过反射获取类的静态字段。</li><li><strong>场景：</strong> 查看配置类中的静态常量值、单例实例、或者其他重要的静态状态。</li></ul></li></ul><h4 id="类与类加载器-排查类相关问题" tabindex="-1"><a class="header-anchor" href="#类与类加载器-排查类相关问题"><span>类与类加载器 (排查类相关问题)</span></a></h4><ul><li><strong><code>sc</code> (Search Class)</strong>: 搜索JVM中已加载的类。 <ul><li><strong>原理：</strong> 遍历所有类加载器，查找匹配类名的类。</li><li><strong>场景：</strong><ul><li><code>sc &lt;类名模式&gt;</code>: 查找类是否存在，被哪个ClassLoader加载。</li><li><code>sc -d &lt;类全名&gt;</code>: 显示类的详细信息，包括加载它的ClassLoader、所属Jar包路径等。<strong>常用于排查类重复加载、类冲突问题。</strong></li><li><code>sc -f &lt;类全名&gt;</code>: 显示类的字段信息。</li></ul></li></ul></li><li><strong><code>sm</code> (Search Method)</strong>: 搜索已加载类的方法信息。 <ul><li><strong>原理：</strong> 通过反射获取类的方法信息。</li><li><strong>场景：</strong> 查找类中是否存在某个方法，确认方法签名是否符合预期。</li></ul></li><li><strong><code>jad</code> (Java Decompiler)</strong>: 反编译指定已加载类的源码。 <ul><li><strong>原理：</strong> 使用内部集成的反编译器（如CFR, JadX等）对JVM内存中的字节码进行反编译。</li><li><strong>场景：</strong> <strong>排查ClassNotFoundException或NoSuchMethodError时确认运行时代码是否与预期一致。</strong> 例如，线上部署了一个新版本，怀疑字节码没更新成功，或者编译/打包出了问题，<code>jad</code> 可以看到JVM实际运行的代码。</li></ul></li><li><strong><code>classloader</code></strong>: 查看类加载器树状结构，以及加载的类数量、路径等。 <ul><li><strong>原理：</strong> 遍历JVM中的ClassLoader父子关系。</li><li><strong>场景：</strong> <strong>排查复杂的类加载隔离、父子委托问题。</strong> 尤其是在使用OSGi、各种容器、热部署框架时，类加载器结构复杂，<code>classloader</code> 命令能清晰地展示结构，帮助定位 <code>LinkageError</code> 等问题。也可以查看某个类是由哪个ClassLoader加载的（结合<code>sc -d</code>）。</li></ul></li></ul><h4 id="方法执行观测与分析-核心诊断能力" tabindex="-1"><a class="header-anchor" href="#方法执行观测与分析-核心诊断能力"><span>方法执行观测与分析 (核心诊断能力)</span></a></h4><ul><li><strong><code>watch</code></strong>: 观测方法执行的输入参数、返回值、抛出异常。 <ul><li><strong>原理：</strong> 通过Instrumentation在方法指定的连接点（entry/return/exception/finish）插入探针，获取上下文变量值。</li><li><strong>语法：</strong> <code>watch &lt;类全名&gt; &lt;方法名&gt; &lt;要观测的表达式&gt; [条件表达式]</code></li><li><strong>场景：</strong> 查看方法的具体调用细节，比如一个请求过来，进入某个Service方法时，参数是什么？返回结果是什么？有没有抛异常？非常适合定位特定输入导致的问题。</li><li><strong>与Debug区别：</strong> <code>watch</code> 是非阻塞的，不会暂停线程；Debug会暂停。<code>watch</code> 可以指定条件，只在满足条件时触发。</li></ul></li><li><strong><code>trace</code></strong>: 追踪方法内部调用路径及耗时。 <ul><li><strong>原理：</strong> 通过Instrumentation在目标方法及其内部调用子方法（可配置深度）的入口和出口插入探针，记录调用链路和方法执行时间。</li><li><strong>语法：</strong> <code>trace &lt;类全名&gt; &lt;方法名&gt; [条件表达式] [#cost &gt; &lt;毫秒&gt;]</code></li><li><strong>场景：</strong> <strong>分析方法性能瓶颈。</strong> 如果一个方法执行很慢，<code>trace</code> 可以告诉你时间主要花费在了哪个内部调用上。也可以用于梳理复杂方法的调用链路。</li><li><strong>与<code>watch</code>区别：</strong> <code>trace</code> 关注的是方法的执行 <em>路径</em> 和 <em>耗时</em>，而 <code>watch</code> 关注的是方法执行 <em>某个点</em> 的 <em>变量值</em>。</li></ul></li><li><strong><code>stack</code></strong>: 输出方法被调用的完整调用栈。 <ul><li><strong>原理：</strong> 通过Instrumentation在方法入口插入探针，获取当前线程的StackTrace。</li><li><strong>语法：</strong> <code>stack &lt;类全名&gt; &lt;方法名&gt; [条件表达式]</code></li><li><strong>场景：</strong> 了解某个方法是在什么情况下、由哪个调用链最终调用的。有助于理解方法的上下文。</li></ul></li><li><strong><code>monitor</code></strong>: 周期性统计方法调用次数、成功率、平均耗时等。 <ul><li><strong>原理：</strong> 通过Instrumentation在方法入口和出口插入探针，进行计数和耗时统计。</li><li><strong>语法：</strong> <code>monitor &lt;类全名&gt; &lt;方法名&gt; [周期秒数]</code></li><li><strong>场景：</strong> <strong>监控接口或关键方法的运行时性能指标。</strong> 比如想知道某个接口 QPS 多少，平均 RT 多少，成功率如何，用 <code>monitor</code> 非常方便。</li></ul></li></ul><h4 id="疑难问题排查利器-高级诊断手段" tabindex="-1"><a class="header-anchor" href="#疑难问题排查利器-高级诊断手段"><span>疑难问题排查利器 (高级诊断手段)</span></a></h4><ul><li><strong><code>tt</code> (Time Tunnel)</strong>: 方法执行数据的“时空隧道”。 <ul><li><strong>原理：</strong> 通过Instrumentation在方法执行前后插入探针，记录方法的整个执行过程信息，包括方法名、参数、返回值、异常、对象引用（可配置深度和数量）等。这些信息被序列化并存储起来。后续可以“穿越”回某个特定的调用现场进行观察或重放。</li><li><strong>核心流程：</strong><ol><li><code>tt -t &lt;类全名&gt; &lt;方法名&gt; [条件表达式]</code>: 开启记录。</li><li>等待目标方法被调用。</li><li><code>tt -s</code>: 查看已记录的方法调用列表。</li><li><code>tt -i &lt;index&gt;</code>: 查看某个记录的详细信息（参数、返回值等）。</li><li><code>tt -i &lt;index&gt; -w &lt;表达式&gt;</code>: 在记录的上下文中用 <code>watch</code> 的语法观察变量值。</li><li><code>tt -i &lt;index&gt; -p</code>: （谨慎使用）对记录的方法调用进行重放（Replay）。</li></ol></li><li><strong>场景：</strong> <strong>排查偶发性、难以复现的Bug的终极利器！</strong> 当一个Bug只在特定条件下偶然发生，无法通过常规手段捕获时，用 <code>tt -t</code> 记录下来，等Bug发生后，通过 <code>tt -s</code> 找到对应的记录，然后 <code>tt -i</code> 详细分析当时输入是什么，结果是什么，甚至可以在当时的上下文中观察任意变量的值，就像回到了案发现场。</li></ul></li><li><strong><code>profiler</code></strong>: 生成应用热点火焰图 (Flame Graph)。 <ul><li><strong>原理：</strong> 基于采样（Sampling）技术。Arthas Agent会以设定的频率去采集所有线程的堆栈信息（CPU Profiler采集正在占用CPU的线程堆栈，可选择Event Profiler采集其他事件如锁等待、IO等待等）。然后对采集到的堆栈进行统计分析，生成火焰图。</li><li><strong>流程：</strong><ol><li><code>profiler start [--event cpu|alloc|lock|...]</code>: 开始采样。通常先用 <code>cpu</code> 事件。</li><li>运行一段时间，让目标应用执行“热”代码（例如跑一段压测）。</li><li><code>profiler stop [--format html]</code>: 停止采样并生成结果文件（默认为JFR格式，<code>--format html</code> 可直接生成火焰图HTML文件）。</li></ol></li><li><strong>场景：</strong> <strong>排查CPU性能瓶颈的利器！</strong> 火焰图能直观地展示在采样期间哪些方法占用了最多的CPU时间（看顶层的函数宽度）。宽度越宽，表示函数在采样中出现的次数越多，通常意味着它或它的子函数消耗的CPU越多。高度表示调用栈深度。<strong>解决“我的应用为什么这么慢，CPU花在哪儿了”的问题。</strong></li></ul></li></ul><h4 id="运行时修改与执行-功能强大但需谨慎" tabindex="-1"><a class="header-anchor" href="#运行时修改与执行-功能强大但需谨慎"><span>运行时修改与执行 (功能强大但需谨慎)</span></a></h4><ul><li><strong><code>redefine</code></strong>: 热更新已加载类的字节码文件。 <ul><li><strong>原理：</strong> 利用Instrumentation的<code>redefineClasses()</code>方法，用新的<code>.class</code> 文件替换掉JVM中对应类的定义。</li><li><strong>限制：</strong> **非常重要！**不能增加或删除类的字段和方法；不能修改方法签名；不能修改类的继承关系。只能修改已有方法的实现内容（方法体）。</li><li><strong>场景：</strong> <strong>快速修复线上Bug。</strong> 如果一个Bug只是方法体内逻辑错误（比如一个常量写错了，一个判断条件反了），可以用 <code>redefine</code> 快速修复，无需重启应用。</li></ul></li><li><strong><code>mc</code> (Memory Compiler)</strong>: 内存中编译 <code>.java</code> 文件。 <ul><li><strong>原理：</strong> 调用Java Compiler API (javax.tools) 在内存中编译Java源码。</li><li><strong>场景：</strong> 通常与 <code>redefine</code> 配合使用。先在本地修改好 <code>.java</code> 文件，通过 <code>mc</code> 命令将源码发送给Agent在目标JVM内存中编译成 <code>.class</code> 字节码，然后立即用 <code>redefine</code> 加载这个新的字节码。</li></ul></li><li><strong><code>ognl</code></strong>: 执行OGNL (Object-Graph Navigation Language) 表达式。 <ul><li><strong>原理：</strong> 在目标JVM中执行一段OGNL表达式。OGNL语法非常强大，可以访问对象属性、调用方法、甚至调用静态方法和访问静态字段。</li><li><strong>场景：</strong> <strong>极其强大，能做很多“不可思议”的事情。</strong><ul><li>调用静态方法：<code>ognl &#39;@java.lang.System@currentTimeMillis()&#39;</code> 获取当前时间戳。</li><li>访问静态字段：<code>ognl &#39;@com.example.Constants@DEBUG_MODE&#39;</code> 查看静态常量值。</li><li>获取和调用Spring Bean：如果应用使用了Spring，可以通过OGNL获取Spring Context，然后通过Context获取任意Bean并调用其方法。例如：<code>ognl &#39;#springContext = @org.springframework.context.ApplicationContext@getInstance(), #springContext.getBean(&quot;userService&quot;).getUserById(123)&#39;</code> (注意：获取Spring Context的方法可能因Spring版本和启动方式而异，需要根据实际情况确定，可能需要结合 <code>sc</code> 和 <code>jad</code> 先找到获取Context的方法)。</li></ul></li><li><strong>风险：</strong> 正因为其强大，<code>ognl</code> 存在巨大的安全风险。恶意用户如果能Attach到JVM并执行 <code>ognl</code> 命令，几乎可以在目标应用中执行任意代码，获取敏感信息，甚至破坏系统。<strong>在线上环境需极其谨慎使用，强烈建议限制访问权限。</strong></li></ul></li></ul><h3 id="四、-arthas的性能影响与安全性" tabindex="-1"><a class="header-anchor" href="#四、-arthas的性能影响与安全性"><span>四、 Arthas的性能影响与安全性</span></a></h3><ul><li><strong>性能开销分析：</strong><ul><li><strong>Attach阶段：</strong> 首次Attach会有短暂的开销，加载Agent到JVM中。</li><li><strong>Agent常驻开销：</strong> Agent本身会占用一定的内存和CPU资源，但在空闲状态下，这部分开销非常小，几乎可以忽略不计。</li><li><strong>命令执行开销：</strong><ul><li>基础信息命令 (<code>dashboard</code>, <code>thread</code>, <code>jvm</code>等): 开销主要在于数据采集和传输，通常较低。</li><li>字节码增强命令 (<code>watch</code>, <code>trace</code>, <code>monitor</code>, <code>tt</code>): <strong>对目标方法的性能有影响。</strong> 这是因为需要插入额外的探针代码。影响程度取决于被增强方法的执行频率、探针逻辑的复杂性、以及匹配的调用次数。如果在高并发、性能敏感的方法上进行复杂观测，可能会引入明显的性能损耗。</li><li><code>profiler</code>: 会周期性地采集线程堆栈，对CPU有一定消耗，消耗量与采样频率成正比。</li><li><code>redefine</code>: 一次性操作，性能影响很小。</li><li><code>ognl</code>: 开销取决于执行的表达式，复杂或耗时的OGNL表达式会影响性能。</li></ul></li><li><strong>总体评价：</strong> 在合理使用、非持续性高强度观测的情况下，Arthas对线上应用的性能影响通常在可接受范围内。关键在于 <strong>理解哪些命令有潜在开销，并避免在高并发核心路径上长时间开启复杂的观测。</strong></li></ul></li><li><strong>安全性考量：</strong><ul><li><strong>Attach权限：</strong> 只有与目标JVM运行在同一用户下，或者具有root权限，才能成功Attach。这是操作系统层面的安全限制。</li><li><strong>Arthas自身的安全机制：</strong> Arthas提供了一些简单的安全配置，如telnet/http端口绑定、允许的IP列表等，但默认配置下安全性较低。</li><li><strong>命令执行风险：</strong> <code>ognl</code>, <code>redefine</code> 等命令允许执行任意代码或修改运行时行为，存在极高的安全风险。</li><li><strong>生产环境建议：</strong><ul><li>严格控制Arthas的访问权限，只允许授权人员操作。</li><li>不将Arthas默认监听的telnet/http端口暴露在外网。</li><li>考虑使用SSH隧道等方式进行安全的远程连接。</li><li>使用时保持警惕，避免执行不确定来源或可能有害的命令。</li></ul></li></ul></li></ul><h3 id="五、-arthas使用最佳实践与技巧" tabindex="-1"><a class="header-anchor" href="#五、-arthas使用最佳实践与技巧"><span>五、 Arthas使用最佳实践与技巧</span></a></h3><ol><li><strong>目标明确，按需执行：</strong> 在诊断问题前先思考清楚要查什么，选择最合适的命令。避免漫无目的地尝试，浪费时间和资源。</li><li><strong>理解开销，谨慎操作：</strong> 特别是 <code>watch</code>, <code>trace</code>, <code>monitor</code>, <code>tt</code>, <code>profiler</code> 等命令，它们会改变目标方法的行为或增加资源消耗。用完及时 <code>reset</code> 或 <code>stop</code> 清理现场。</li><li><strong>组合命令，循序渐进：</strong><ul><li>诊断CPU飙高：先 <code>dashboard</code> 或 <code>thread -n</code> 找到热点线程ID，然后用 <code>thread &lt;ID&gt;</code> 查看堆栈，确定是哪个业务代码导致，再用 <code>trace</code> 或 <code>profiler</code> 深入分析耗时或CPU占用分布。</li><li>诊断接口慢：先 <code>dashboard</code> 看整体负载，用 <code>monitor</code> 看接口 QPS 和 RT，确认是普遍慢还是偶发慢。如果是普遍慢，用 <code>trace</code> 分析方法内部耗时。如果是偶发慢，考虑用 <code>tt</code> 记录偶发慢请求的现场。</li><li>诊断类问题：先 <code>sc</code> 查找类，用 <code>sc -d</code> 看加载详情，用 <code>jad</code> 看代码，用 <code>classloader</code> 查看类加载器层级。</li></ul></li><li><strong>善用条件表达式：</strong> <code>watch</code>, <code>trace</code>, <code>stack</code>, <code>tt</code> 都支持条件表达式（使用OGNL语法），例如 <code>params[0].userId == &#39;123&#39;</code> 或 <code>returnObj == null</code>。这能让你只观测符合特定条件的调用，减少数据量，提高效率。</li><li><strong>利用输出重定向和管道：</strong> Arthas命令的输出可以重定向到文件 (<code>&gt;</code>) 或通过管道传递给其他命令 (<code>|</code>，如 <code>grep</code>)，方便过滤和保存结果。</li><li><strong>周期性执行：</strong> 部分命令（如 <code>thread</code>, <code>dashboard</code>）支持 <code>-c &lt;次数&gt;</code> 或 <code>-i &lt;间隔秒数&gt;</code> 进行周期性输出，方便动态观察。</li><li><strong>在预发/测试环境充分演练：</strong> 熟悉命令用法、输出格式以及潜在的性能影响，避免在生产环境“摸索”。</li></ol><h3 id="六、-与其他诊断工具的对比" tabindex="-1"><a class="header-anchor" href="#六、-与其他诊断工具的对比"><span>六、 与其他诊断工具的对比</span></a></h3><p>Arthas并非唯一的诊断工具，但它有着独特的定位和优势：</p><ul><li><strong>JMX/JConsole/VisualVM：</strong> 这些是基于JMX的工具，主要提供JVM运行时指标的概览（内存、线程、GC、MBean等）。它们缺乏对代码执行细节（方法调用、参数、返回值）的动态观测能力，也无法进行热更新。是Arthas的良好补充，常用于宏观监控。</li><li><strong>JProfiler/YourKit：</strong> 商业化的强大Profiling工具，功能非常全面，能进行深度的CPU、内存、线程分析。通常需要在应用启动时配置Agent。相比之下，Arthas更轻量级，无需重启，专注于线上临时诊断和动态观测。</li><li><strong>jstack/jmap/jinfo：</strong> JDK自带的命令行工具，用于获取特定时刻的线程堆栈、内存Dump、JVM配置信息。它们提供的是“静态快照”，无法进行动态观测和运行时修改。Arthas集成了这些工具的功能，并提供了更友好的交互和更强大的动态能力。</li></ul><p>总的来说，Arthas在“无需重启、动态实时观测方法执行细节并进行问题诊断”这个领域具有显著优势，是其他工具难以替代的。它与JMX工具、dump分析工具等是互补关系，共同构成了Java线上诊断的工具集。</p><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>Arthas以其非侵入、动态、实时的特性和丰富的功能集，极大地提升了Java线上问题排查和性能调优的效率。从基础的JVM状态查看，到深入的方法执行观测、类加载分析，再到强大的时空隧道和火焰图，Arthas为Java工程师提供了前所未有的洞察能力。</p><p>官网地址：https://arthas.aliyun.com/</p></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/tool/Arthas.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: oointer@163.com">Yideng</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/javabaguwen/tool/GuavaCache.html" aria-label="Guava Cache缓存"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->Guava Cache缓存</div></a><!----></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2025 Mr.Hope </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/javabaguwen/assets/app-CzKZ5RuK.js" defer></script>
  </body>
</html>
