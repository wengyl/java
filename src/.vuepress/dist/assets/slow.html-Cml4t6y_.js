import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,e as n,o as l}from"./app-CzKZ5RuK.js";const s={};function i(o,e){return l(),t("div",null,e[0]||(e[0]=[n(`<h2 id="_1-慢查询日志的作用" tabindex="-1"><a class="header-anchor" href="#_1-慢查询日志的作用"><span>1. 慢查询日志的作用</span></a></h2><p>慢查询日志默认不开启，建议手动开启，方便我们定位线上问题。 执行时间超过阈值的SQL会被写入到慢查询日志当中，这样可以帮助我们记录执行时间过长的SQL语句，定位线上慢SQL问题，方便我们进行SQL性能调优。</p><h2 id="_2-慢查询日志的配置" tabindex="-1"><a class="header-anchor" href="#_2-慢查询日志的配置"><span>2. 慢查询日志的配置</span></a></h2><h3 id="_2-1-查看是否开启了慢查询日志" tabindex="-1"><a class="header-anchor" href="#_2-1-查看是否开启了慢查询日志"><span>2.1 查看是否开启了慢查询日志</span></a></h3><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>show variables like &#39;slow_query_log&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://javabaguwen.com/img/慢查询日志1.png" alt="image-20220802212557114.png" loading="lazy"> 默认是OFF，不开启，可以手动开启。</p><h3 id="_2-2-开启慢查询日志" tabindex="-1"><a class="header-anchor" href="#_2-2-开启慢查询日志"><span>2.2 开启慢查询日志</span></a></h3><p>一种方法是可以使用MySQL命令开启：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>set global slow_query_log=1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://javabaguwen.com/img/慢查询日志2.png" alt="image-20220802212706986.png" tabindex="0" loading="lazy"><figcaption>image-20220802212706986.png</figcaption></figure><p>另一种方法是修改MySQL配置文件，重新MySQL服务后，开启。</p><blockquote><p>修改配置文件my.cnf，加入下面一行命令 slow_query_log = ON</p></blockquote><h3 id="_2-3-设置慢查询日志的阈值" tabindex="-1"><a class="header-anchor" href="#_2-3-设置慢查询日志的阈值"><span>2.3 设置慢查询日志的阈值</span></a></h3><p>慢查询日志的阈值默认是10，单位是秒。 对于线上服务来说，10秒太长了，我们可以手动修改。 <img src="https://javabaguwen.com/img/慢查询日志3.png" alt="image-20220802213552061.png" loading="lazy"> 一种是通过MySQL命令修改，比如修改为1秒：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>set long_query_time=1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://javabaguwen.com/img/慢查询日志4.png" alt="image-20220802214215003.png" loading="lazy"> 另一种方法是修改MySQL配置文件，重新MySQL服务后，开启。</p><blockquote><p>修改配置文件my.cnf，加入下面一行命令 long_query_time = 1</p></blockquote><h3 id="_2-4-修改慢查询日志位置" tabindex="-1"><a class="header-anchor" href="#_2-4-修改慢查询日志位置"><span>2.4 修改慢查询日志位置</span></a></h3><p>使用MySQL命令查看慢查询日志位置：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>show variables like &#39;%slow_query_log_file%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://javabaguwen.com/img/慢查询日志5.png" alt="image-20220802214504879.png" loading="lazy"> 想要修改慢查询日志位置，可以修改MySQL配置文件，重新MySQL服务后，开启。</p><blockquote><p>修改配置文件my.cnf，加入下面一行命令 slow_query_log_file = /usr/local/mysql/data/localhost_slow.log</p></blockquote><h3 id="_2-5-记录更多慢查询sql" tabindex="-1"><a class="header-anchor" href="#_2-5-记录更多慢查询sql"><span>2.5 记录更多慢查询SQL</span></a></h3><p>默认情况下管理语句是不会被记录到慢查询日志中，管理语句包括ALTER TABLE、 ANALYZE TABLE、 CHECK TABLE、 CREATE INDEX、 DROP INDEX、 OPTIMIZE TABLE和 REPAIR TABLE等。 <img src="https://javabaguwen.com/img/慢查询日志6.png" alt="image-20220802220313648.png" loading="lazy"> 管理语句也是非常重要的，如果想要被记录，可以通过MySQL命令修改：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>set global log_slow_admin_statements=ON;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://javabaguwen.com/img/慢查询日志8.png" alt="image-20220802220532705.png" loading="lazy"> 默认情况下，不使用索引的语句，也是不会被记录的。 够坑人吧！一不留神就掉坑里了，不记录不使用索引的语句，还要慢查询日志干嘛？ <img src="https://javabaguwen.com/img/慢查询日志9.png" alt="image-20220802220828942.png" loading="lazy"> 想要记录不使用索引的语句，可以通过命令修改：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>set global log_queries_not_using_indexes=ON;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://javabaguwen.com/img/慢查询日志10.png" alt="image-20220802220936024.png" tabindex="0" loading="lazy"><figcaption>image-20220802220936024.png</figcaption></figure><h2 id="_3-慢查询日志的使用" tabindex="-1"><a class="header-anchor" href="#_3-慢查询日志的使用"><span>3. 慢查询日志的使用</span></a></h2><p>手动造一条慢SQL，测试一下效果，user表中有100万表数据：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>select * from user;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后看一下慢查询日志文件的内容：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>cat /usr/local/mysql/data/localhost_slow.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://javabaguwen.com/img/慢查询日志11.png" alt="image-20220802215744087.png" loading="lazy"> SQL语句和执行时间都被记录了。</p><h2 id="_4-分析慢查询日志" tabindex="-1"><a class="header-anchor" href="#_4-分析慢查询日志"><span>4. 分析慢查询日志</span></a></h2><p>有时候慢查询日志较多，手动查看起来并不是很方便，好在MySQL提供了分析慢查询日志的工具<strong>mysqldumpslow</strong>。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>常用参数有

<span class="token operator">-</span>s<span class="token operator">:</span> 表示按何种方式排序：
　　c<span class="token operator">:</span> 访问次数
　　l<span class="token operator">:</span> 锁定时间
　　r<span class="token operator">:</span> 返回记录
　　t<span class="token operator">:</span> 查询时间
　　al<span class="token operator">:</span> 平均锁定时间
　　ar<span class="token operator">:</span> 平均返回记录数
　　at<span class="token operator">:</span> 平均查询时间
<span class="token operator">-</span>t<span class="token operator">:</span> 返回前面多少条的数据；
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-1-查询返回结果最多的10条sql" tabindex="-1"><a class="header-anchor" href="#_4-1-查询返回结果最多的10条sql"><span>4.1 查询返回结果最多的10条SQL：</span></a></h3><blockquote><p>mysqldumpslow -s r -t 10 /usr/local/mysql/data/localhost_slow.log</p></blockquote><figure><img src="https://javabaguwen.com/img/慢查询日志12.png" alt="image-20220802221842502.png" tabindex="0" loading="lazy"><figcaption>image-20220802221842502.png</figcaption></figure><h3 id="_4-2-查询耗时最长的10条sql" tabindex="-1"><a class="header-anchor" href="#_4-2-查询耗时最长的10条sql"><span>4.2 查询耗时最长的10条SQL：</span></a></h3><blockquote><p>mysqldumpslow -s t -t 10 /usr/local/mysql/data/localhost_slow.log</p></blockquote><figure><img src="https://javabaguwen.com/img/慢查询日志13.png" alt="image-20220802221842502.png" tabindex="0" loading="lazy"><figcaption>image-20220802221842502.png</figcaption></figure>`,43)]))}const d=a(s,[["render",i],["__file","slow.html.vue"]]),g=JSON.parse('{"path":"/mysql/slow.html","title":"","lang":"zh-CN","frontmatter":{"description":"1. 慢查询日志的作用 慢查询日志默认不开启，建议手动开启，方便我们定位线上问题。 执行时间超过阈值的SQL会被写入到慢查询日志当中，这样可以帮助我们记录执行时间过长的SQL语句，定位线上慢SQL问题，方便我们进行SQL性能调优。 2. 慢查询日志的配置 2.1 查看是否开启了慢查询日志 image-20220802212557114.png 默认是O...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/javabaguwen/mysql/slow.html"}],["meta",{"property":"og:site_name","content":"Java八股文网"}],["meta",{"property":"og:description","content":"1. 慢查询日志的作用 慢查询日志默认不开启，建议手动开启，方便我们定位线上问题。 执行时间超过阈值的SQL会被写入到慢查询日志当中，这样可以帮助我们记录执行时间过长的SQL语句，定位线上慢SQL问题，方便我们进行SQL性能调优。 2. 慢查询日志的配置 2.1 查看是否开启了慢查询日志 image-20220802212557114.png 默认是O..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%971.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-29T06:25:28.000Z"}],["meta",{"property":"article:author","content":"Mr.Hope"}],["meta",{"property":"article:modified_time","content":"2025-04-29T06:25:28.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%971.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%972.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%973.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%974.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%975.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%976.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%978.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%979.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%9710.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%9711.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%9712.png\\",\\"https://javabaguwen.com/img/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%9713.png\\"],\\"dateModified\\":\\"2025-04-29T06:25:28.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hope\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"1. 慢查询日志的作用","slug":"_1-慢查询日志的作用","link":"#_1-慢查询日志的作用","children":[]},{"level":2,"title":"2. 慢查询日志的配置","slug":"_2-慢查询日志的配置","link":"#_2-慢查询日志的配置","children":[{"level":3,"title":"2.1 查看是否开启了慢查询日志","slug":"_2-1-查看是否开启了慢查询日志","link":"#_2-1-查看是否开启了慢查询日志","children":[]},{"level":3,"title":"2.2 开启慢查询日志","slug":"_2-2-开启慢查询日志","link":"#_2-2-开启慢查询日志","children":[]},{"level":3,"title":"2.3 设置慢查询日志的阈值","slug":"_2-3-设置慢查询日志的阈值","link":"#_2-3-设置慢查询日志的阈值","children":[]},{"level":3,"title":"2.4 修改慢查询日志位置","slug":"_2-4-修改慢查询日志位置","link":"#_2-4-修改慢查询日志位置","children":[]},{"level":3,"title":"2.5 记录更多慢查询SQL","slug":"_2-5-记录更多慢查询sql","link":"#_2-5-记录更多慢查询sql","children":[]}]},{"level":2,"title":"3. 慢查询日志的使用","slug":"_3-慢查询日志的使用","link":"#_3-慢查询日志的使用","children":[]},{"level":2,"title":"4. 分析慢查询日志","slug":"_4-分析慢查询日志","link":"#_4-分析慢查询日志","children":[{"level":3,"title":"4.1 查询返回结果最多的10条SQL：","slug":"_4-1-查询返回结果最多的10条sql","link":"#_4-1-查询返回结果最多的10条sql","children":[]},{"level":3,"title":"4.2 查询耗时最长的10条SQL：","slug":"_4-2-查询耗时最长的10条sql","link":"#_4-2-查询耗时最长的10条sql","children":[]}]}],"git":{"createdTime":1745907928000,"updatedTime":1745907928000,"contributors":[{"name":"Yideng","email":"oointer@163.com","commits":1}]},"readingTime":{"minutes":3.28,"words":984},"filePathRelative":"mysql/slow.md","localizedDate":"2025年4月29日","autoDesc":true}');export{d as comp,g as data};
