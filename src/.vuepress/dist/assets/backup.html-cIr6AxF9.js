import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e as i,o as n}from"./app-CzKZ5RuK.js";const l={};function s(d,e){return n(),a("div",null,e[0]||(e[0]=[i(`<p>大家好，我是一灯，今天一块学习一下如何优雅安全的备份MySQL数据？</p><h2 id="_1-为什么要备份数据" tabindex="-1"><a class="header-anchor" href="#_1-为什么要备份数据"><span>1. 为什么要备份数据</span></a></h2><p>先说一下为什么需要备份MySQL数据？ 一句话总结就是：<strong>为了保证数据的安全性。</strong> 如果我们把数据只存储在一个地方，如果物理机器损坏，会导致数据丢失，无法恢复。 还有就是我们每次手动修改线上数据之前，为了安全起见，都需要先备份数据。防止人为的误操作，导致弄脏数据或弄丢数据。</p><h2 id="_2-怎样备份mysql数据" tabindex="-1"><a class="header-anchor" href="#_2-怎样备份mysql数据"><span>2. 怎样备份MySQL数据？</span></a></h2><p>想要快速简单粗暴备份MySQL数据，可以使用<strong>mysqldump</strong>命令：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 备份test数据库
mysqldump -uroot -p test &gt; backup.db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>但是这样备份的可能包含脏数据，比如在我们备份数据的过程中，有个下单的操作正在执行。 下单之后，还没有来得及扣款，就开始执行备份数据的命令，就会出现脏数据。</p><ol><li>下单，保存订单表</li><li>备份数据</li><li>扣款</li></ol><h2 id="_3-怎么安全的备份数据" tabindex="-1"><a class="header-anchor" href="#_3-怎么安全的备份数据"><span>3. 怎么安全的备份数据？</span></a></h2><p>mysqldump命令也提供了以事务的形式备份的参数：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 开启一个事务备份test数据库
mysqldump -uroot -p --single-transaction test &gt; backup.db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>开启事务后，会跟正常业务操作产生锁资源竞争，可能会阻塞其他的业务操作，严重的可能会导致服务宕机，所以备份操作尽量在业务低峰期执行。 还有一个问题，只有InnoDB引擎支持事务命令，对于不支持的事务MyISAM引擎，备份数据的时候怎么保证数据的安全性呢？ 有一个粗暴的办法就是设置全库只读，禁止写操作，这样备份的时候不就能保证数据安全性啦。 先用命令查看一下数据库的只读状态：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>show variables like &#39;read_only&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://javabaguwen.com/img/备份数据1.png" alt="" loading="lazy"> OFF表示只读模式关闭，ON表示开启只读模式。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>set global read_only=1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://javabaguwen.com/img/备份数据2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这样设置其实是非常危险的，如果客户端连接断开，整个数据库也会一直处于只读模式，无法进行写操作。 更推荐的办法是设置<strong>全局锁  FTWRL（flush tables with read lock）</strong>。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 设置全局锁，禁止写操作
flush tables with read lock;
# 释放锁
unlock tables;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置全局锁之后，如果客户端断开，会自动释放锁，更安全。</p><h2 id="_4-怎么恢复数据" tabindex="-1"><a class="header-anchor" href="#_4-怎么恢复数据"><span>4. 怎么恢复数据？</span></a></h2><p>通过备份文件恢复数据也非常简单：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 把备份文件数据导入到test数据库
mysqldump -uroot -p test &lt; backup.db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,22)]))}const c=t(l,[["render",s],["__file","backup.html.vue"]]),p=JSON.parse('{"path":"/mysql/backup.html","title":"","lang":"zh-CN","frontmatter":{"description":"大家好，我是一灯，今天一块学习一下如何优雅安全的备份MySQL数据？ 1. 为什么要备份数据 先说一下为什么需要备份MySQL数据？ 一句话总结就是：为了保证数据的安全性。 如果我们把数据只存储在一个地方，如果物理机器损坏，会导致数据丢失，无法恢复。 还有就是我们每次手动修改线上数据之前，为了安全起见，都需要先备份数据。防止人为的误操作，导致弄脏数据或...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/javabaguwen/mysql/backup.html"}],["meta",{"property":"og:site_name","content":"Java八股文网"}],["meta",{"property":"og:description","content":"大家好，我是一灯，今天一块学习一下如何优雅安全的备份MySQL数据？ 1. 为什么要备份数据 先说一下为什么需要备份MySQL数据？ 一句话总结就是：为了保证数据的安全性。 如果我们把数据只存储在一个地方，如果物理机器损坏，会导致数据丢失，无法恢复。 还有就是我们每次手动修改线上数据之前，为了安全起见，都需要先备份数据。防止人为的误操作，导致弄脏数据或..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://javabaguwen.com/img/%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE1.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-29T06:25:28.000Z"}],["meta",{"property":"article:author","content":"Mr.Hope"}],["meta",{"property":"article:modified_time","content":"2025-04-29T06:25:28.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"https://javabaguwen.com/img/%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE1.png\\",\\"https://javabaguwen.com/img/%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE2.png\\"],\\"dateModified\\":\\"2025-04-29T06:25:28.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hope\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"1. 为什么要备份数据","slug":"_1-为什么要备份数据","link":"#_1-为什么要备份数据","children":[]},{"level":2,"title":"2. 怎样备份MySQL数据？","slug":"_2-怎样备份mysql数据","link":"#_2-怎样备份mysql数据","children":[]},{"level":2,"title":"3. 怎么安全的备份数据？","slug":"_3-怎么安全的备份数据","link":"#_3-怎么安全的备份数据","children":[]},{"level":2,"title":"4. 怎么恢复数据？","slug":"_4-怎么恢复数据","link":"#_4-怎么恢复数据","children":[]}],"git":{"createdTime":1745907928000,"updatedTime":1745907928000,"contributors":[{"name":"Yideng","email":"oointer@163.com","commits":1}]},"readingTime":{"minutes":2.28,"words":683},"filePathRelative":"mysql/backup.md","localizedDate":"2025年4月29日","autoDesc":true}');export{c as comp,p as data};
