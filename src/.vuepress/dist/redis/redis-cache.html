<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.38" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/javabaguwen/redis/redis-cache.html"><meta property="og:site_name" content="Java八股文网"><meta property="og:description" content="在构建高并发、高可用分布式系统时，缓存是几乎无法绕过的关键组件。Redis凭借其极致的内存速度、丰富的数据结构以及单线程模型带来的原子性，成为业界最受欢迎的缓存首选。然而，缓存并非银弹，引入它的同时也带来了新的挑战：如何管理缓存的生命周期？如何在有限的内存中存放更多热点数据？当缓存失效时，如何避免对后端存储（如数据库）造成灾难性的冲击？ 本文将带你深入..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-05-01T16:05:51.000Z"><meta property="article:author" content="Mr.Hope"><meta property="article:modified_time" content="2025-05-01T16:05:51.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"","image":[""],"dateModified":"2025-05-01T16:05:51.000Z","author":[{"@type":"Person","name":"Mr.Hope","url":"https://mister-hope.com"}]}</script><title>Java八股文网</title><meta name="description" content="在构建高并发、高可用分布式系统时，缓存是几乎无法绕过的关键组件。Redis凭借其极致的内存速度、丰富的数据结构以及单线程模型带来的原子性，成为业界最受欢迎的缓存首选。然而，缓存并非银弹，引入它的同时也带来了新的挑战：如何管理缓存的生命周期？如何在有限的内存中存放更多热点数据？当缓存失效时，如何避免对后端存储（如数据库）造成灾难性的冲击？ 本文将带你深入...">
    <link rel="preload" href="/javabaguwen/assets/style-BlxzwH3B.css" as="style"><link rel="stylesheet" href="/javabaguwen/assets/style-BlxzwH3B.css">
    <link rel="modulepreload" href="/javabaguwen/assets/app-CzKZ5RuK.js"><link rel="modulepreload" href="/javabaguwen/assets/redis-cache.html-OtONNZWb.js"><link rel="modulepreload" href="/javabaguwen/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/javabaguwen/assets/index.html-BIyLuIZF.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/home.html-C5FRllnR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/rabbitmq-framework.html-BJfTRdzN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/updating.html-BTqB4lev.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C8HE3sTb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BofRPUP9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-array.html-CQh2BX_6.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-listnode.html-BvccyswQ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-other.html-K02tHtJV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-sort.html-C0ujop87.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-string.html-q9_U9xvR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-tree.html-fzmi3uQe.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/AQS.html-CYJjvTlb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/AtomicInteger.html-7TMQuKsp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CountDownLatch.html-CYv1LQ1Z.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CyclicBarrier.html-dCzoFKnI.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ReentrantLock.html-DT7NPqvu.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Semaphore.html-Du-7oZ5-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Synchronized.html-CLfoofuc.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Thread.html-DKAwCMmT.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ThreadLocal.html-DOskLcBZ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ThreadPool.html-V9AKjCqz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/volatile.html-McyFZwId.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CGtdkXoz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DcfeFKU4.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/disable.html-CjEhayv1.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/encrypt.html-DyasH04g.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/layout.html-CLX-uWFx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/markdown.html-CVZwBvfb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/page.html-BEnAPjYC.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/dubbo-framework.html-DGnuTtZS.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/jvm-framework.html-wqzu3og7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BsR05xgW.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/annotation.html-DRaOvbGf.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/copy.html-nTurp9_0.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/delivery.html-87bW9ZQu.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/exception.html-ElW60mXV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/generic.html-CKmc6Kja.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/java8.html-DuspJqsS.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/proxy.html-Bj_HftOj.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/reflect.html-CpONb-0n.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ArrayBlockingQueue.html-CO-2EzLw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ArrayList.html-BonMJYMw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/BlockingQueue合集.html-DI6C5W2f.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ConcurrentHashMap.html-_TOD-950.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CopyOnWriteArrayList.html-B5zGDOwU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/DelayQueue.html-iUAKqX_T.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/HashMap.html-Cc28QPf4.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedBlockingQueue.html-C3gbP6Hy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedHashMap.html-D1iaN7fZ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedList.html-s_Gg-gJ-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/PriorityQueue.html-B75Nhyur.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Set.html-WDNqLCw9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/SynchronousQueue.html-D9kHbkxa.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/TreeMap.html-JDD-EDSl.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-framework.html-t1PB4Ym7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-message.html-CJe0pgjk.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-select.html-DZ5JgX2c.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/MySQL链路追踪.html-BnDBpO2n.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/backup.html-cIr6AxF9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/dead.html-DDinBR_w.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/engine.html-DCorJ_Si.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/explain.html-BBbXvmoq.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/framework.html-DSt6zGky.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BJ13k3j_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/lock.html-hf9PfmVp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/log.html-CP_B3iV1.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/MVCC.html-DFpZ9Xsd.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/online.html-XNa1bdSw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/optimize.html-DmAv8Wa2.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/page.html-n1_eFn8N.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/performance.html-10BbqZ0p.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/phantom.html-C71tbTxW.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/push.html-q6XvQohg.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/range.html-BZUxJlnM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/second.html-B7C_rXBU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/skip.html-DhiPjR3y.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/slow.html-Cml4t6y_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/standard.html-BgjOOG7w.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/sync.html-Dl0JIUZG.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/three.html-BV1cBk6B.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/timeout.html-D_C43jRE.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/transaction.html-BhOB1bIO.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/netty-framework.html-B-INaDy8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/mybatis-framework.html-hn-wmowB.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ShardingSphere-framework.html-ijRl8ypt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/RocketMQ-transaction.html-BCvpslaN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/rocketmq-framwork.html-Bu3WJkdY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-batch.html-CZkEnRbz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-bigkey.html-DUhEL8XR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-cluster.html-DXASisVt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-data.html-DrT2dBuq.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-fast.html-COH-y8uJ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-hotkey.html-Bug7S0FM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-lock.html-BpMAcuRp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-mq.html-BNQhQCLK.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-persistent.html-wZc4pSik.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-thread.html-7XZWhA7_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-transaction.html-DFFKtk5_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-annotation.html-8TpZm-ME.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-framework.html-DqY461Gt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-work.html-MrZ6RZ0c.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-eureka.html-DQqATMuM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-feign.html-dOnWbHIR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-framework.html-pCyUxtT8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-gateway.html-6yFi7TZ8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-hystrix.html-ikGPNR8A.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-ribbon.html-3CwdE5RY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-select.html-ChKzgBHi.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-zuul.html-BhCaZOhm.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-annotation.html-CxO4w72H.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-start.html-DXm_zidT.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-starter.html-Dg_Ei0cx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-what.html-BzYUyf9C.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/zookeeper-framework.html-DhcA8Ae_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-annotation.html-DhccIzq7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-bean.html-9HbZMsGo.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-depend.html-CwWmirDv.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-design.html-DPOuT1Sx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-framework.html-HsSq5DPU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-ioc-aop.html-BkFkS5_m.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-transaction.html-ClIKZH47.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C0r6933U.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/baz.html-CA5_i735.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-8CTMKBd3.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ray.html-BRNlRk6d.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-controller.html-fbsoqZpr.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-framework.html-Dra6O8Z5.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-leader.html-Do79ltBr.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-message.html-aE5Mz7vy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Arthas.html-D0D8wX0z.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CodeReview.html-r6MmZq89.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/GuavaCache.html-BxqdD_rY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/git.html-DlT79MnX.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/404.html-CNH5e1PP.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BZB_9PUz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Dpc2uxYQ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-tzWzwKAt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BROoLkQz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BJD-pPo-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C-kSMRah.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CwU0YFHN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CGuRoTHs.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-InAU6Ddc.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BhUNVG5k.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DbJ8HS_0.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Bi55j3tV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-D6bkBnce.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CC0VLLj5.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-B5y_vezN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-oHslfc13.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DthGt63M.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Dr08pODp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BLmvLduy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/giscus-1zs_z9NH.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/photoswipe.esm-DXWKOczD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/javabaguwen/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Java八股文网</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/" aria-label="项目主页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>项目主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/home.html" aria-label="Java八股文"><span class="font-icon icon fa-fw fa-sm fas fa-eight" style=""></span>Java八股文<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/interview/" aria-label="面试流程"><span class="font-icon icon fa-fw fa-sm fas fa-interview" style=""></span>面试流程<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/algo/" aria-label="算法"><span class="font-icon icon fa-fw fa-sm fas fa-algo" style=""></span>算法<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/tool/" aria-label="工具"><span class="font-icon icon fa-fw fa-sm fas fa-tool" style=""></span>工具<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/about/" aria-label="关于"><span class="font-icon icon fa-fw fa-sm fas fa-about" style=""></span>关于<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/home.html" aria-label="一、前言"><!---->一、前言<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">二、Java基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">三、Java进阶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">四、数据库</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-data.html" aria-label="4.1 Redis数据结构"><!---->4.1 Redis数据结构<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-batch.html" aria-label="4.2 Redis批量命令"><!---->4.2 Redis批量命令<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/javabaguwen/redis/redis-cache.html" aria-label="4.3 Redis缓存问题"><!---->4.3 Redis缓存问题<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-fast.html" aria-label="4.4 Redis快的原因"><!---->4.4 Redis快的原因<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-thread.html" aria-label="4.6 Redis线程模型"><!---->4.6 Redis线程模型<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-bigkey.html" aria-label="4.7 Redis大key问题"><!---->4.7 Redis大key问题<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-hotkey.html" aria-label="4.8 Redis热点key问题"><!---->4.8 Redis热点key问题<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-persistent.html" aria-label="4.9 Redis持久化"><!---->4.9 Redis持久化<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-transaction.html" aria-label="4.10 Redis事务"><!---->4.10 Redis事务<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-cluster.html" aria-label="4.11 Redis集群"><!---->4.11 Redis集群<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-mq.html" aria-label="4.12 Redis消息队列"><!---->4.12 Redis消息队列<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/redis/redis-lock.html" aria-label="4.13 Redis分布式锁"><!---->4.13 Redis分布式锁<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">五、JVM</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">六、框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">七、消息队列</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!----></h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">Mr.Hope</a></span><span property="author" content="Mr.Hope"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-04-29T10:53:44.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 17 分钟</span><meta property="timeRequired" content="PT17M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<!----><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#一、-redis缓存管理机制深度解析">一、 Redis缓存管理机制深度解析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#三、-经典缓存问题与解决方案">三、 经典缓存问题与解决方案</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#四、-java应用中的实践与整合">四、 Java应用中的实践与整合</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#五、-面试官视角-理解这些问题的意义">五、 面试官视角：理解这些问题的意义</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结">总结</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><p>在构建高并发、高可用分布式系统时，缓存是几乎无法绕过的关键组件。Redis凭借其极致的内存速度、丰富的数据结构以及单线程模型带来的原子性，成为业界最受欢迎的缓存首选。然而，缓存并非银弹，引入它的同时也带来了新的挑战：如何管理缓存的生命周期？如何在有限的内存中存放更多热点数据？当缓存失效时，如何避免对后端存储（如数据库）造成灾难性的冲击？</p><p>本文将带你深入理解Redis作为缓存时的两大管理机制：<strong>过期键删除</strong>和<strong>内存淘汰</strong>，并重点剖析缓存领域的“经典三剑客”问题：<strong>缓存穿透、缓存击穿、缓存雪崩</strong>，及其原理和行之有效的解决方案。掌握这些，不仅能让你更好地设计和维护缓存系统，也能在面试中展现出对分布式缓存的深刻理解。</p><h3 id="一、-redis缓存管理机制深度解析" tabindex="-1"><a class="header-anchor" href="#一、-redis缓存管理机制深度解析"><span>一、 Redis缓存管理机制深度解析</span></a></h3><p>使用Redis作为缓存，最核心的需求之一就是管理内存和数据的“新鲜度”。这就涉及到了过期键的删除和内存不足时的淘汰。</p><h4 id="_1-过期键删除策略-key-expiration-strategy" tabindex="-1"><a class="header-anchor" href="#_1-过期键删除策略-key-expiration-strategy"><span>1. 过期键删除策略 (Key Expiration Strategy)</span></a></h4><p>为什么Key会过期？很简单，为了让数据有生命周期，自动失效，从而释放内存空间，并保证数据的“新鲜度”（比如用户的Session、商品的促销信息等）。</p><p>Redis中为Key设置过期时间（TTL - Time To Live 或 EXPIRE / PEXPIRE 命令）后，Redis如何知道一个Key是否过期了呢？每个设置了过期时间的Key都会被放入一个独立的字典中，记录着Key和它的过期时间戳（一个long long类型的整数）。</p><p>关键在于，Redis如何删除这些过期的Key？它并非简单地启动一个线程遍历所有Key来删除，那样太低效。Redis结合使用了两种策略：</p><ul><li><p><strong>惰性删除 (Lazy Deletion):</strong></p><ul><li><strong>原理：</strong> 就像它的名字一样“懒惰”。Redis并不会主动删除过期的Key，而是在<strong>每次客户端访问（GET, SET等操作）某个Key时</strong>，先检查这个Key的过期时间。如果发现Key已经过期，那么在执行命令前，Redis会立即删除这个Key，并返回一个表示Key不存在的结果。</li><li><strong>优点：</strong> 对CPU非常友好。只有在Key被访问时才进行检查和删除，平时CPU开销极低。Redis的主线程（处理命令的线程）不会因为删除过期键而长时间阻塞。</li><li><strong>缺点：</strong> 可能导致大量已过期但长时间未被访问的Key继续占用内存空间。如果一个Key设置了过期时间，但之后再也没有被访问过，它可能一直留在内存里，直到被“定期删除”或者“内存淘汰”策略清理掉。</li></ul></li><li><p><strong>定期删除 (Active Deletion):</strong></p><ul><li><strong>原理：</strong> 相比惰性删除，定期删除稍微勤快一些。Redis会周期性地（默认每秒进行10次）运行一个<strong>后台任务</strong>。这个任务会做几件事情： <ol><li>从设置了过期时间的数据库（Redis有16个默认数据库）中，<strong>随机抽取</strong>一部分数据库进行检查。</li><li>在每个被检查的数据库中，<strong>随机抽取</strong>一部分设置了过期时间的Key。</li><li>删除这些随机抽取的Key中已经过期的Key。</li><li>如果本次删除操作中，过期Key的比例超过一定阈值（例如25%），任务可能会再执行一次，直到过期Key比例低于阈值或达到设定的时间上限（默认是25毫秒）。</li></ol></li><li><strong>优点：</strong> 能够有效地清理一部分过期Key，回收内存，避免过期Key长时间占用空间。</li><li><strong>缺点：</strong> 任务执行会占用一定的CPU资源，尤其是在过期Key比例较高时，可能会稍微影响主线程的服务能力。注意，这是一个<strong>概率性</strong>的检查和删除过程，不能保证所有到期Key都能被及时删除。</li></ul></li><li><p><strong>Redis的组合策略：</strong> Redis正是通过巧妙结合这两种策略来达到一个平衡。通过<strong>定期删除</strong>，可以回收大部分过期内存；通过<strong>惰性删除</strong>，可以确保访问时不会读到过期数据，并及时清理那些恰好在访问时过期的Key。即使某些过期Key逃过了定期删除，最终也会在内存不足时被内存淘汰策略清理掉。</p></li></ul><p><strong>面试关联点：</strong> 面试官经常会问：“Redis的Key到期了，是怎么删除的？是立刻删除吗？”，“Lazy Free（异步删除）和惰性删除、定期删除有什么区别？”（Lazy Free是用于大Key删除时防止阻塞主线程的技术，不是删除过期键的主要策略）。</p><h4 id="_2-内存淘汰策略-memory-eviction-strategy" tabindex="-1"><a class="header-anchor" href="#_2-内存淘汰策略-memory-eviction-strategy"><span>2. 内存淘汰策略 (Memory Eviction Strategy)</span></a></h4><p>当Redis使用的内存达到 <code>maxmemory</code> 参数设定的上限，并且又有新的数据需要写入时，Redis就需要“忍痛割爱”，根据一定的规则<strong>淘汰</strong>一部分现有的Key，为新的数据腾出空间。这就是内存淘汰策略。</p><p><strong>为什么需要淘汰？</strong> 因为内存是有限的！如果没有淘汰策略，一旦内存写满，Redis就会拒绝新的写入请求，导致服务不可用。</p><p><code>maxmemory-policy</code> 配置选项决定了当内存不足时，Redis会采用哪种策略来选择要淘汰的Key：</p><ul><li><code>noeviction</code>: 这是默认策略。当内存不足以容纳新写入的数据时，新写入操作会报错。除非删除一些Key，否则无法再写入。通常不用于缓存场景。</li><li><strong>LRU 系列 (Least Recently Used - 最少最近使用):</strong> 优先淘汰最近最少被访问的Key。 <ul><li><code>allkeys-lru</code>: 从所有Key中选择最近最少使用的Key进行淘汰。</li><li><code>volatile-lru</code>: 从<strong>设置了过期时间</strong>的Key中选择最近最少使用的Key进行淘汰。</li></ul></li><li><strong>LFU 系列 (Least Frequently Used - 最少频率使用):</strong> 优先淘汰访问频率最低的Key。LFU比LRU更能体现Key的“热门程度”。 <ul><li><code>allkeys-lfu</code>: 从所有Key中选择访问频率最低的Key进行淘汰。</li><li><code>volatile-lfu</code>: 从<strong>设置了过期时间</strong>的Key中选择访问频率最低的Key进行淘汰。</li></ul></li><li><code>allkeys-random</code>: 从所有Key中随机选择Key进行淘汰。</li><li><code>volatile-random</code>: 从<strong>设置了过期时间</strong>的Key中随机选择Key进行淘汰。</li><li><code>volatile-ttl</code>: 从<strong>设置了过期时间</strong>的Key中，选择<strong>剩余生存时间（TTL）最短</strong>的Key进行淘汰。</li></ul><p><strong>深入讲解LRU/LFU的实现：采样近似算法</strong></p><p>注意！Redis并没有实现严格精确的LRU或LFU算法。精确的LRU需要维护一个所有Key的链表，每次访问都要移动节点，开销巨大；精确的LFU需要为每个Key维护访问计数器，并在合适的时候递减，同样复杂。</p><p>Redis采用的是<strong>采样近似算法</strong>：</p><ol><li>Redis配置一个 <code>maxmemory-samples</code> 参数（默认是5）。</li><li>当需要进行内存淘汰时，Redis会<strong>随机抽取</strong> <code>maxmemory-samples</code> 个Key。</li><li>然后根据当前的淘汰策略（LRU/LFU/TTL），在这随机抽取的这几个Key中，选择那个“最不符合要求”的Key进行淘汰（例如，LRU就淘汰这几个Key中最近访问时间最久的那个）。</li><li>重复步骤2和3，直到内存满足要求。</li></ol><p><strong>为什么是采样近似？</strong> 这是一个性能与效果的权衡。随机采样的方式开销很低，虽然不能保证淘汰的是全局最优的Key，但在大多数情况下，通过多次采样和淘汰，也能比较好地接近LRU/LFU的效果。提高 <code>maxmemory-samples</code> 可以提高近似的准确度，但会增加CPU开销。</p><p><strong>如何选择合适的淘汰策略？</strong></p><ul><li>如果所有Key都用于缓存，且没有设置过期时间，或者希望所有Key都能参与淘汰：考虑 <code>allkeys-lru</code> 或 <code>allkeys-lfu</code>。通常 <code>allkeys-lru</code> 是一个不错的通用选择。</li><li>如果只有部分Key设置了过期时间，且你希望优先淘汰这些带有时间属性的Key：考虑 <code>volatile-lru</code>, <code>volatile-lfu</code>, <code>volatile-ttl</code>。这是最常见的缓存场景配置，特别是 <code>volatile-lru</code> 和 <code>volatile-lfu</code>。</li><li>如果数据重要性都很随机，或者对淘汰策略要求不高：可以考虑 <code>random</code> 系列，性能开销最低。</li></ul><p><strong>面试关联点：</strong> 面试官会深入问你Redis LRU/LFU 是如何实现的？采样近似算法的原理？ <code>maxmemory-samples</code> 参数的作用？精确和近似算法的优劣？</p><h3 id="三、-经典缓存问题与解决方案" tabindex="-1"><a class="header-anchor" href="#三、-经典缓存问题与解决方案"><span>三、 经典缓存问题与解决方案</span></a></h3><p>理解了Redis自身管理缓存的机制，我们再来看看在使用缓存时，应用层面可能遇到的三个经典问题。</p><h4 id="_1-缓存穿透-cache-penetration" tabindex="-1"><a class="header-anchor" href="#_1-缓存穿透-cache-penetration"><span>1. 缓存穿透 (Cache Penetration)</span></a></h4><ul><li><strong>问题描述：</strong> 指客户端请求的数据，<strong>既不在缓存中，也不在后端数据库中</strong>。例如，恶意用户持续查询一个永不存在的商品ID。</li><li><strong>危害：</strong> 由于缓存不命中，每次请求都会穿透缓存层，直接打到数据库，可能导致数据库压力过大甚至崩溃。就像水流穿过有孔的筛子，直接冲刷底部。</li><li><strong>解决方案深度解析：</strong><ul><li><strong>缓存空结果 (Cache Null Result):</strong><ul><li><strong>原理：</strong> 当应用从数据库中查询不到某个Key对应的数据时，不在缓存中简单地留空，而是在缓存中存储一个特定的“空值”或“不存在”标记（比如一个特定的字符串常量 <code>__EMPTY__</code>），并设置一个较短的过期时间（例如几分钟）。</li><li><strong>优点：</strong> 后续对该不存在Key的请求会命中缓存中的空值标记，直接返回，不再访问数据库。实现简单。</li><li><strong>缺点：</strong> 需要额外的内存来存储这些空值Key，可能会占用不少空间。需要根据实际情况设置合理的过期时间，避免“不存在”的数据长时间占用缓存。应用层需要对返回的空值标记进行特殊处理。</li></ul></li><li><strong>布隆过滤器 (Bloom Filter):</strong><ul><li><strong>原理：</strong> 布隆过滤器是一个概率型数据结构，用于判断一个元素是否在一个集合中。它由一个很长的二进制向量和一系列哈希函数组成。向过滤器中添加元素时，通过多个哈希函数将元素映射到二进制向量的多个位置，并将这些位置的位设置为1。查询元素时，同样通过哈希函数映射到多个位置，如果这些位置对应的位都是1，则判断元素<strong>可能</strong>存在；如果有一个位是0，则判断元素<strong>一定不存在</strong>。</li><li><strong>优势：</strong> <strong>内存效率极高</strong>，相比缓存空结果，占用内存非常小，尤其适用于可能不存在的Key数量巨大的场景。对不存在的Key判断速度快，能有效拦截大量穿透请求。</li><li><strong>缺点：</strong> 存在误判（False Positive）：即元素实际不存在，但由于哈希碰撞，过滤器判断它可能存在。此时请求会穿透过滤器，打到数据库（然后可能被缓存空结果方案拦截）。不能删除元素。需要数据库同步更新布隆过滤器，维护成本较高。</li><li><strong>面试关联点：</strong> 布隆过滤器的原理（哈希碰撞、误判率与空间/哈希函数数量的关系）、误判如何处理。</li></ul></li><li><strong>其他：</strong> 在应用层对非法参数进行校验过滤，避免无效请求进入缓存层。</li></ul></li></ul><h4 id="_2-缓存击穿-cache-breakdown-hot-spot-key-problem" tabindex="-1"><a class="header-anchor" href="#_2-缓存击穿-cache-breakdown-hot-spot-key-problem"><span>2. 缓存击穿 (Cache Breakdown / Hot Spot Key Problem)</span></a></h4><ul><li><strong>问题描述：</strong> 指一个<strong>非常热点</strong>的Key（例如，某个明星的微博ID、某个爆款商品的库存Key），在缓存中正好过期了，此时有大量的并发请求涌入，都无法命中缓存，这些请求会<strong>同时</strong>去查询数据库。</li><li><strong>危害：</strong> 数据库在极短时间内收到大量针对同一个Key的请求，可能导致数据库线程被打满甚至崩溃。就像有人用一把“狙击枪”，精确地击穿了缓存的某个点。</li><li><strong>解决方案深度解析：</strong><ul><li><strong>互斥锁 (Mutex / Distributed Lock):</strong><ul><li><strong>原理：</strong> 当第一个请求发现缓存未命中时，它尝试去获取一个针对该Key的<strong>分布式锁</strong>（例如使用Redis的 <code>SETNX</code> 命令，或 ZooKeeper/Etcd 等）。如果成功获取锁，则由该请求负责去数据库加载数据并回写缓存。其他未能获取到锁的请求则等待锁释放，或者直接返回一个错误/默认值/旧数据。</li><li><strong>优点：</strong> 有效地将并发请求转化为串行请求，保护数据库不被瞬时流量冲垮。</li><li><strong>实现：</strong> 在Java代码中，可以使用 <code>synchronized</code> 关键字（仅限于单进程）或更常用的是基于Redis、ZooKeeper等实现的分布式锁。使用Redis实现时，可以利用 <code>SET key value NX EX seconds</code> 命令来原子地设置锁和过期时间。</li><li><strong>缺点：</strong> 未获取到锁的请求会被阻塞，增加了响应延迟。需要考虑锁的过期时间、死锁、锁的可重入性等问题。</li></ul></li><li><strong>热点数据永不过期：</strong><ul><li><strong>原理：</strong> 将特别热点的数据Key设置为永不过期。</li><li><strong>优点：</strong> 简单粗暴，直接避免击穿问题。</li><li><strong>缺点：</strong> 数据可能永远不会自动更新，需要依赖显式更新或后台任务更新。如果热点Key太多，可能占用过多内存。</li></ul></li><li><strong>逻辑过期：</strong><ul><li><strong>原理：</strong> 不给Key设置真实的TTL，而是在缓存存储的值内部添加一个表示过期的时间戳或一个TTL字段。客户端获取Key时，先判断值内部的时间是否过期。如果逻辑过期，则<strong>异步</strong>地触发一个后台线程去更新缓存，同时仍然返回旧的（逻辑已过期但物理未删除的）数据给当前请求。</li><li><strong>优点：</strong> 不会阻塞客户端，数据库压力平缓（异步更新）。</li><li><strong>缺点：</strong> 实现相对复杂，客户端需要处理“逻辑过期”的判断和旧数据的返回。可能会短暂返回陈旧数据。</li></ul></li></ul></li></ul><h4 id="_3-缓存雪崩-cache-avalanche" tabindex="-1"><a class="header-anchor" href="#_3-缓存雪崩-cache-avalanche"><span>3. 缓存雪崩 (Cache Avalanche)</span></a></h4><ul><li><strong>问题描述：</strong> 指<strong>大量Key</strong>在<strong>同一时间</strong>集中失效，或者Redis服务<strong>宕机</strong>，导致原本应该由缓存分担的巨大流量在瞬间全部涌向数据库。</li><li><strong>危害：</strong> 数据库在短时间内接收到远超负荷的请求，可能直接被打垮，进而导致整个应用系统服务中断，形成连锁反应。这就像雪山的积雪，一旦崩塌，势不可挡。</li><li><strong>解决方案深度解析：</strong><ul><li><strong>Redis高可用：</strong> 这是最根本的解决Redis宕机导致的雪崩问题。部署Redis Sentinel（哨兵）或 Redis Cluster（集群），确保Redis服务的稳定性和可用性。</li><li><strong>分散Key的过期时间：</strong> 这是应对大量Key同时失效的关键。在设置Key的过期时间时，不要使用固定的TTL，而是在基础TTL上<strong>加上一个小的随机值（随机分散）</strong>。例如，本来Key的TTL是1小时，可以设置为 $1小时 + random(0, 5分钟)$。这样，即使Key的创建时间相近，它们的过期时间也会分散开，避免集中失效。</li><li><strong>多级缓存：</strong> 构建多层缓存体系。例如，在应用服务内部使用进程内缓存（如Caffeine），在前面再部署Redis集群。当Redis集群发生问题时，至少进程内缓存还能承担一部分流量，不至于所有请求都打到数据库。</li><li><strong>服务降级或限流：</strong> 在系统层面设计熔断和限流机制。当检测到下游服务（如数据库）压力过大或响应变慢时，可以触发服务降级，例如对部分非核心业务关闭缓存，或者直接拒绝部分请求，牺牲部分用户体验以保护核心服务。</li><li><strong>缓存空结果：</strong> (同穿透解决方案) 也能在一定程度上缓解雪崩，特别是当雪崩由大量查询不存在的数据引起时。</li></ul></li></ul><h3 id="四、-java应用中的实践与整合" tabindex="-1"><a class="header-anchor" href="#四、-java应用中的实践与整合"><span>四、 Java应用中的实践与整合</span></a></h3><p>在Java应用中实现这些方案，需要结合Redis客户端库（如Jedis或Lettuce）进行：</p><ul><li><strong>设置过期时间：</strong> 使用 <code>SET key value EX seconds</code> 或 <code>PEXPIRE key milliseconds</code> 命令。为避免雪崩，可以在Java代码中生成随机的过期时间：<code>int ttl = BASE_TTL + random.nextInt(RANDOM_EXTRA_SECONDS); jedis.setex(key, ttl, value);</code></li><li><strong>处理空结果：</strong> 从Redis获取Key后，判断返回值是否为null（Key不存在）或特定的空值标记字符串。如果是空值标记，则直接返回空，不再查询数据库。存储空值时：<code>jedis.setex(emptyKey, EMPTY_TTL, &quot;__EMPTY__&quot;);</code></li><li><strong>实现击穿互斥锁：</strong> 利用Redis <code>SETNX key value EX seconds</code> 命令（Jedis的 <code>set(key, value, &quot;NX&quot;, &quot;EX&quot;, seconds)</code> 方法）尝试获取锁。获取成功则查询DB，回写缓存，最后删除锁。未获取成功则等待或返回。</li><li><strong>布隆过滤器：</strong> 可以使用Guava的BloomFilter或Redisson的RBloomFilter等开源库。需要在数据写入DB或缓存时，同步更新布隆过滤器。</li></ul><h3 id="五、-面试官视角-理解这些问题的意义" tabindex="-1"><a class="header-anchor" href="#五、-面试官视角-理解这些问题的意义"><span>五、 面试官视角：理解这些问题的意义</span></a></h3><p>为什么这些缓存问题在面试中如此重要？因为它们是衡量一个工程师<strong>设计高可用、高性能分布式系统能力</strong>的试金石。面试官通过询问这些问题，考察你：</p><ul><li>对缓存本质和局限性的理解。</li><li>对Redis内部工作机制（过期、淘汰）的掌握程度。</li><li>分析和定位线上问题的能力。</li><li>设计和权衡不同解决方案的能力（空间、时间、实现复杂度）。</li><li>对系统稳定性的重视和保障手段。</li></ul><p>常见的问法往往是结合具体场景：“如果你的电商系统商品详情页QPS很高，但数据库时不时压力过大，你会从哪些方面排查？可能是什么问题？怎么解决？”，“缓存击穿和雪崩有什么区别？怎么应对？”，“你们系统的缓存命中率怎么样？Key的过期时间是怎么设置的？考虑过集中过期的问题吗？”</p><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>Redis作为缓存为我们带来了巨大的性能提升，但同时也引入了过期删除、内存淘汰、缓存穿透、缓存击穿、缓存雪崩等一系列挑战。理解Redis自身的缓存管理机制，并掌握针对经典缓存问题的防御手段，是中高级Java工程师必备的核心技能。</p><p>过期键的<strong>惰性删除</strong>和<strong>定期删除</strong>、内存不足时的<strong>采样近似淘汰策略</strong>（LRU/LFU等）是Redis保障自身内存和数据新鲜度的手段。而<strong>缓存穿透</strong>（查不存在的）、<strong>缓存击穿</strong>（热点Key失效）和<strong>缓存雪崩</strong>（大量Key失效或Redis宕机）则是应用层需要主动设计防御体系来解决的问题。</p><p>通过<strong>缓存空结果</strong>、<strong>布隆过滤器</strong>应对穿透；通过<strong>互斥锁</strong>、<strong>永不过期</strong>、<strong>逻辑过期</strong>解决击穿；通过<strong>高可用架构</strong>、<strong>过期时间分散</strong>、<strong>多级缓存</strong>、<strong>限流降级</strong>应对雪崩。这些解决方案并非相互独立，在实际系统中常常组合使用，构建多层防护。</p></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/redis/redis-cache.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: oointer@163.com">Yideng</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/javabaguwen/redis/redis-batch.html" aria-label="4.2 Redis批量命令"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->4.2 Redis批量命令</div></a><a class="route-link nav-link next" href="/javabaguwen/redis/redis-fast.html" aria-label="4.4 Redis快的原因"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">4.4 Redis快的原因<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2025 Mr.Hope </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/javabaguwen/assets/app-CzKZ5RuK.js" defer></script>
  </body>
</html>
