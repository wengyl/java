<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.38" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/javabaguwen/springcloud/springcloud-eureka.html"><meta property="og:site_name" content="Java八股文网"><meta property="og:description" content="在微服务架构中，服务实例是动态变化的：它们会因为扩缩容而增加或减少，会因为部署而启动或停止，会因为故障而上线或下线。在这种环境下，服务消费者不能依赖硬编码的服务提供者地址。如何让服务消费者动态、可靠地找到服务提供者？这就是服务发现 (Service Discovery) 要解决的问题。 在 Spring Cloud 生态中，Eureka 是一个非常经典..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-05-01T16:05:51.000Z"><meta property="article:author" content="Mr.Hope"><meta property="article:modified_time" content="2025-05-01T16:05:51.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"","image":[""],"dateModified":"2025-05-01T16:05:51.000Z","author":[{"@type":"Person","name":"Mr.Hope","url":"https://mister-hope.com"}]}</script><title>Java八股文网</title><meta name="description" content="在微服务架构中，服务实例是动态变化的：它们会因为扩缩容而增加或减少，会因为部署而启动或停止，会因为故障而上线或下线。在这种环境下，服务消费者不能依赖硬编码的服务提供者地址。如何让服务消费者动态、可靠地找到服务提供者？这就是服务发现 (Service Discovery) 要解决的问题。 在 Spring Cloud 生态中，Eureka 是一个非常经典...">
    <link rel="preload" href="/javabaguwen/assets/style-BlxzwH3B.css" as="style"><link rel="stylesheet" href="/javabaguwen/assets/style-BlxzwH3B.css">
    <link rel="modulepreload" href="/javabaguwen/assets/app-CzKZ5RuK.js"><link rel="modulepreload" href="/javabaguwen/assets/springcloud-eureka.html-DQqATMuM.js"><link rel="modulepreload" href="/javabaguwen/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/javabaguwen/assets/index.html-BIyLuIZF.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/home.html-C5FRllnR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/rabbitmq-framework.html-BJfTRdzN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/updating.html-BTqB4lev.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C8HE3sTb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BofRPUP9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-array.html-CQh2BX_6.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-listnode.html-BvccyswQ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-other.html-K02tHtJV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-sort.html-C0ujop87.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-string.html-q9_U9xvR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/algo-tree.html-fzmi3uQe.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/AQS.html-CYJjvTlb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/AtomicInteger.html-7TMQuKsp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CountDownLatch.html-CYv1LQ1Z.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CyclicBarrier.html-dCzoFKnI.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ReentrantLock.html-DT7NPqvu.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Semaphore.html-Du-7oZ5-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Synchronized.html-CLfoofuc.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Thread.html-DKAwCMmT.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ThreadLocal.html-DOskLcBZ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ThreadPool.html-V9AKjCqz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/volatile.html-McyFZwId.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CGtdkXoz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DcfeFKU4.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/disable.html-CjEhayv1.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/encrypt.html-DyasH04g.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/layout.html-CLX-uWFx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/markdown.html-CVZwBvfb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/page.html-BEnAPjYC.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/dubbo-framework.html-DGnuTtZS.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/jvm-framework.html-wqzu3og7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BsR05xgW.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/annotation.html-DRaOvbGf.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/copy.html-nTurp9_0.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/delivery.html-87bW9ZQu.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/exception.html-ElW60mXV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/generic.html-CKmc6Kja.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/java8.html-DuspJqsS.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/proxy.html-Bj_HftOj.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/reflect.html-CpONb-0n.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ArrayBlockingQueue.html-CO-2EzLw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ArrayList.html-BonMJYMw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/BlockingQueue合集.html-DI6C5W2f.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ConcurrentHashMap.html-_TOD-950.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CopyOnWriteArrayList.html-B5zGDOwU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/DelayQueue.html-iUAKqX_T.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/HashMap.html-Cc28QPf4.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedBlockingQueue.html-C3gbP6Hy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedHashMap.html-D1iaN7fZ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/LinkedList.html-s_Gg-gJ-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/PriorityQueue.html-B75Nhyur.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Set.html-WDNqLCw9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/SynchronousQueue.html-D9kHbkxa.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/TreeMap.html-JDD-EDSl.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-framework.html-t1PB4Ym7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-message.html-CJe0pgjk.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-select.html-DZ5JgX2c.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/MySQL链路追踪.html-BnDBpO2n.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/backup.html-cIr6AxF9.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/dead.html-DDinBR_w.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/engine.html-DCorJ_Si.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/explain.html-BBbXvmoq.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/framework.html-DSt6zGky.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BJ13k3j_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/lock.html-hf9PfmVp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/log.html-CP_B3iV1.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/MVCC.html-DFpZ9Xsd.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/online.html-XNa1bdSw.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/optimize.html-DmAv8Wa2.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/page.html-n1_eFn8N.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/performance.html-10BbqZ0p.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/phantom.html-C71tbTxW.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/push.html-q6XvQohg.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/range.html-BZUxJlnM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/second.html-B7C_rXBU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/skip.html-DhiPjR3y.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/slow.html-Cml4t6y_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/standard.html-BgjOOG7w.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/sync.html-Dl0JIUZG.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/three.html-BV1cBk6B.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/timeout.html-D_C43jRE.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/transaction.html-BhOB1bIO.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/netty-framework.html-B-INaDy8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/mybatis-framework.html-hn-wmowB.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ShardingSphere-framework.html-ijRl8ypt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/RocketMQ-transaction.html-BCvpslaN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/rocketmq-framwork.html-Bu3WJkdY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-batch.html-CZkEnRbz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-bigkey.html-DUhEL8XR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-cache.html-OtONNZWb.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-cluster.html-DXASisVt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-data.html-DrT2dBuq.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-fast.html-COH-y8uJ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-hotkey.html-Bug7S0FM.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-lock.html-BpMAcuRp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-mq.html-BNQhQCLK.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-persistent.html-wZc4pSik.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-thread.html-7XZWhA7_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/redis-transaction.html-DFFKtk5_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-annotation.html-8TpZm-ME.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-framework.html-DqY461Gt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springmvc-work.html-MrZ6RZ0c.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-feign.html-dOnWbHIR.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-framework.html-pCyUxtT8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-gateway.html-6yFi7TZ8.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-hystrix.html-ikGPNR8A.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-ribbon.html-3CwdE5RY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-select.html-ChKzgBHi.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springcloud-zuul.html-BhCaZOhm.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-annotation.html-CxO4w72H.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-start.html-DXm_zidT.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-starter.html-Dg_Ei0cx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/springboot-what.html-BzYUyf9C.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/zookeeper-framework.html-DhcA8Ae_.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-annotation.html-DhccIzq7.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-bean.html-9HbZMsGo.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-depend.html-CwWmirDv.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-design.html-DPOuT1Sx.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-framework.html-HsSq5DPU.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-ioc-aop.html-BkFkS5_m.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/spring-transaction.html-ClIKZH47.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C0r6933U.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/baz.html-CA5_i735.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-8CTMKBd3.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/ray.html-BRNlRk6d.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-controller.html-fbsoqZpr.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-framework.html-Dra6O8Z5.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-leader.html-Do79ltBr.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/kafka-message.html-aE5Mz7vy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/Arthas.html-D0D8wX0z.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/CodeReview.html-r6MmZq89.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/GuavaCache.html-BxqdD_rY.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/git.html-DlT79MnX.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/404.html-CNH5e1PP.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BZB_9PUz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Dpc2uxYQ.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-tzWzwKAt.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BROoLkQz.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BJD-pPo-.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-C-kSMRah.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CwU0YFHN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CGuRoTHs.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-InAU6Ddc.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BhUNVG5k.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DbJ8HS_0.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Bi55j3tV.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-D6bkBnce.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-CC0VLLj5.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-B5y_vezN.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-oHslfc13.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-DthGt63M.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-Dr08pODp.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/index.html-BLmvLduy.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/giscus-1zs_z9NH.js" as="script"><link rel="prefetch" href="/javabaguwen/assets/photoswipe.esm-DXWKOczD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/javabaguwen/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Java八股文网</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/" aria-label="项目主页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>项目主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/home.html" aria-label="Java八股文"><span class="font-icon icon fa-fw fa-sm fas fa-eight" style=""></span>Java八股文<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/interview/" aria-label="面试流程"><span class="font-icon icon fa-fw fa-sm fas fa-interview" style=""></span>面试流程<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/algo/" aria-label="算法"><span class="font-icon icon fa-fw fa-sm fas fa-algo" style=""></span>算法<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/tool/" aria-label="工具"><span class="font-icon icon fa-fw fa-sm fas fa-tool" style=""></span>工具<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/javabaguwen/about/" aria-label="关于"><span class="font-icon icon fa-fw fa-sm fas fa-about" style=""></span>关于<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/home.html" aria-label="一、前言"><!---->一、前言<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">二、Java基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">三、Java进阶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">四、数据库</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">五、JVM</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">六、框架</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">SpringBoot</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">SpringMVC</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">SpringCloud</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/springcloud/springcloud-framework.html" aria-label="SpringCloud架构设计"><!---->SpringCloud架构设计<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/springcloud/springcloud-select.html" aria-label="SpringCloud体系架构选型"><!---->SpringCloud体系架构选型<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/javabaguwen/springcloud/springcloud-eureka.html" aria-label="Eureka架构设计"><!---->Eureka架构设计<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/springcloud/springcloud-feign.html" aria-label="open feign架构设计"><!---->open feign架构设计<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/springcloud/springcloud-gateway.html" aria-label="SpringCloud Gateway架构设计"><!---->SpringCloud Gateway架构设计<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/springcloud/springcloud-hystrix.html" aria-label="Hystrix架构设计"><!---->Hystrix架构设计<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/springcloud/springcloud-ribbon.html" aria-label="Ribbon架构设计"><!---->Ribbon架构设计<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/javabaguwen/springcloud/springcloud-zuul.html" aria-label="Zuul架构设计"><!---->Zuul架构设计<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Dubbo</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Netty</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ShardingSphere</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">zookeeper</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">mybatis</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">七、消息队列</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!----></h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mister-hope.com" target="_blank" rel="noopener noreferrer">Mr.Hope</a></span><span property="author" content="Mr.Hope"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-04-29T10:53:44.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 18 分钟</span><meta property="timeRequired" content="PT18M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<!----><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#深度解析-spring-cloud-eureka-微服务如何找到彼此">深度解析 Spring Cloud Eureka：微服务如何找到彼此</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#引言-动态世界下的服务发现挑战">引言：动态世界下的服务发现挑战</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eureka-是什么-定位与目标">Eureka 是什么？定位与目标</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么需要-eureka-或服务发现">为什么需要 Eureka（或服务发现）？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eureka-架构深度解析">Eureka 架构深度解析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eureka-工作流程">Eureka 工作流程</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#spring-cloud-集成-eureka-的使用方式">Spring Cloud 集成 Eureka 的使用方式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#理解-eureka-架构与使用方式的价值">理解 Eureka 架构与使用方式的价值</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#eureka-为何是面试热点">Eureka 为何是面试热点</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#面试问题示例与深度解析">面试问题示例与深度解析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#总结">总结</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><p>在微服务架构中，服务实例是动态变化的：它们会因为扩缩容而增加或减少，会因为部署而启动或停止，会因为故障而上线或下线。在这种环境下，服务消费者不能依赖硬编码的服务提供者地址。如何让服务消费者动态、可靠地找到服务提供者？这就是<strong>服务发现 (Service Discovery)</strong> 要解决的问题。</p><p>在 Spring Cloud 生态中，Eureka 是一个非常经典且广泛使用的服务发现组件。理解 Eureka 的架构、工作流程及其在 Spring Cloud 中的使用方式，是掌握微服务核心通信机制的基础，也是面试中衡量你对服务发现和服务治理理解深度的重要指标。</p><p>今天，我们就来深度剖析 Netflix Eureka，并结合 Spring Cloud 看看如何使用它。</p><hr><h2 id="深度解析-spring-cloud-eureka-微服务如何找到彼此" tabindex="-1"><a class="header-anchor" href="#深度解析-spring-cloud-eureka-微服务如何找到彼此"><span>深度解析 Spring Cloud Eureka：微服务如何找到彼此</span></a></h2><h3 id="引言-动态世界下的服务发现挑战" tabindex="-1"><a class="header-anchor" href="#引言-动态世界下的服务发现挑战"><span>引言：动态世界下的服务发现挑战</span></a></h3><p>在传统的单体应用或少数几个服务的 SOA 架构中，服务间的调用地址通常是静态配置的。但在微服务架构下，服务实例的数量和网络位置是高度动态的：</p><ul><li>服务会根据负载自动扩缩容。</li><li>服务会频繁进行部署、升级、回滚。</li><li>服务实例可能因为硬件、网络或应用自身原因而意外宕机。</li></ul><p>面对这种动态性，如果服务消费者仍然使用静态地址，将无法及时感知服务提供者的变化，导致调用失败、服务不可用。因此，我们需要一个机制来动态地注册服务提供者的信息，并供服务消费者查询。这就是服务发现。</p><p>Netflix Eureka 是由 Netflix 开发并开源的服务发现组件，Spring Cloud Netflix 项目对其进行了集成，使其成为 Spring Cloud 生态中早期且流行的服务发现解决方案。<strong>（需要注意的是，Netflix 官方已将 Eureka 置于维护模式，不再积极开发新功能，但它作为服务发现的经典实现，其设计思想和原理依然非常重要，且在现有系统中和面试中仍广泛存在。）</strong></p><p>理解 Eureka 的架构和使用方式，能让你：</p><ul><li>掌握服务发现这一微服务核心模式的实现细节。</li><li>理解 Eureka 如何在分布式环境下提供高可用性服务。</li><li>了解 CAP 定理在实际系统设计中的取舍。</li><li>高效搭建和配置 Spring Cloud Eureka 服务。</li><li>排查服务注册和发现过程中的问题。</li><li>自信应对面试中关于服务发现和 Eureka 的提问。</li></ul><p>接下来，我们将深入 Eureka 的架构、工作流程，并结合 Spring Cloud 讲解其使用方式。</p><h3 id="eureka-是什么-定位与目标" tabindex="-1"><a class="header-anchor" href="#eureka-是什么-定位与目标"><span>Eureka 是什么？定位与目标</span></a></h3><p>Eureka 是 Netflix 用于实现<strong>服务注册中心 (Service Registry)</strong> 的一个开源项目。</p><ul><li><strong>定位：</strong> 它是一个基于 REST 的服务，用于定位运行中的服务实例，以实现负载均衡和故障转移的中间层。</li><li><strong>目标：</strong> 提供一个高可用、可伸缩的服务注册中心，让微服务能够发现彼此。</li></ul><p>Eureka 包含两个主要组件：</p><ul><li><strong>Eureka Server：</strong> 服务注册中心，一个独立的应用，用于接收服务实例的注册、维护服务注册信息，并提供查询接口。</li><li><strong>Eureka Client：</strong> 集成在各个微服务中，负责向 Eureka Server 进行服务注册、发送心跳续约、以及从 Server 获取注册信息以进行服务发现。</li></ul><h3 id="为什么需要-eureka-或服务发现" tabindex="-1"><a class="header-anchor" href="#为什么需要-eureka-或服务发现"><span>为什么需要 Eureka（或服务发现）？</span></a></h3><p>静态配置服务地址在微服务场景下不可行，主要原因在于服务实例的动态性。服务发现解决了这个问题，而 Eureka 提供了：</p><ul><li><strong>去中心化/弹性：</strong> Eureka Server 集群之间是平等的，采用 Peer-to-Peer 的方式同步数据，部分节点宕机不影响整个系统可用性。</li><li><strong>可用性优先：</strong> 在网络分区故障发生时，Eureka 优先保证服务的可用性，而不是强一致性（遵循 CAP 定理的 AP 原则）。</li><li><strong>客户端缓存：</strong> Eureka Client 会缓存服务注册信息，即使 Server 全部宕机，客户端也能继续使用缓存的地址进行服务调用（虽然可能调用到已下线的实例）。</li><li><strong>简单易用：</strong> 提供了 RESTful API 和 Java 客户端库，易于集成。</li></ul><h3 id="eureka-架构深度解析" tabindex="-1"><a class="header-anchor" href="#eureka-架构深度解析"><span>Eureka 架构深度解析</span></a></h3><p>理解 Eureka 的架构，关键在于理解 Server 和 Client 的职责以及 Server 集群如何实现高可用。</p><ol><li><p><strong>Eureka Server：服务注册中心</strong></p><ul><li><strong>主要职责：</strong><ul><li><strong>接收服务注册 (Registration)：</strong> 接收 Eureka Client 发送的注册请求，将服务实例信息存储在内存注册表中。</li><li><strong>提供服务发现 (Discovery)：</strong> 接收 Eureka Client 发送的查询请求，将注册表中的服务实例信息返回给客户端。</li><li><strong>心跳续约 (Renewal)：</strong> 接收 Eureka Client 发送的心跳请求，判断服务实例是否存活，更新实例的租约时间。</li><li><strong>服务下线 (De-registration)：</strong> 接收 Eureka Client 发送的下线请求，将服务实例从注册表中移除。</li><li><strong>剔除服务 (Eviction)：</strong> 如果在一定时间内（默认 90 秒）没有收到服务实例的心跳，Server 会将该实例从注册表中剔除。</li></ul></li><li><strong>注册表：</strong> 内存中的数据结构，存储所有已注册的服务实例信息（服务名称、实例 ID、IP 地址、端口号、状态等）。</li></ul></li><li><p><strong>Eureka Client：集成在微服务中</strong></p><ul><li><strong>主要职责：</strong><ul><li><strong>服务注册：</strong> 在微服务启动时，向 Eureka Server 发送注册请求，将自己的信息注册到 Server 端。</li><li><strong>心跳续约：</strong> 定期（默认 30 秒）向 Eureka Server 发送心跳请求，告知 Server 自己还活着，防止被剔除。</li><li><strong>服务发现/获取注册列表：</strong> 定期（默认 30 秒）从 Eureka Server 获取完整的注册表信息，并更新到本地缓存。</li><li><strong>客户端缓存：</strong> 在本地维护一份服务注册信息的缓存。所有对服务发现的请求（如查找某个服务的所有实例）都优先查询本地缓存。这大大减轻了 Server 的压力，并提供了对 Server 故障的弹性。</li><li><strong>服务下线：</strong> 在微服务正常关闭时，向 Eureka Server 发送下线请求，优雅地将自己从注册表中移除。</li></ul></li></ul></li><li><p><strong>Peer-to-Peer 复制 (高可用 - HA)：</strong></p><ul><li><strong>原理：</strong> Eureka Server 集群中的各个节点都是平等的。它们之间不依赖任何外部协调服务。每个 Eureka Server 实例既是 Server，同时也是 Client，它们会尝试向集群中的其他 Peer Server 注册自己，并将自己的注册表信息<strong>异步地复制</strong>给其他 Peer。</li><li><strong>工作方式：</strong><ul><li>当一个服务实例向任一 Eureka Server (Peer A) 注册时，Peer A 收到注册信息后，会立即将其添加到自己的注册表中。</li><li>Peer A 会尝试将这个注册信息异步地发送给它的所有 Peer (Peer B, Peer C...)。</li><li>如果 Peer B 收到注册信息，就更新自己的注册表。如果发送失败，Peer A 会定期重试。</li><li>每个 Peer Server 也会定期从它的其他 Peer Server 拉取注册表信息，进行同步，解决异步复制可能导致的数据不一致问题。</li></ul></li><li><strong>作用：</strong> 即使部分 Peer Server 宕机，只要还有一个 Server 存活，服务实例就可以向其注册和续约，服务消费者也可以从存活的 Server 获取注册信息（即使可能不是最新的），从而保证了注册中心的高可用性。</li></ul></li><li><p><strong>可用性 vs 一致性 (CAP 定理的 AP 选择)：</strong></p><ul><li><strong>CAP 定理简述：</strong> 在分布式系统中， Consistency (一致性)、 Availability (可用性)、 Partition tolerance (分区容错性) 三者不可兼得，最多只能同时满足其中两个。</li><li><strong>Eureka 的选择：</strong> Eureka 优先选择了 <strong>Availability (可用性) 和 Partition tolerance (分区容错性)</strong>，牺牲了一部分 Consistency (一致性)。它是 AP 系统。</li><li><strong>体现：</strong><ul><li><strong>Peer-to-Peer 异步复制：</strong> 在网络分区或部分节点故障时，Eureka Server 之间可能出现注册表不一致的情况。例如，一个服务实例向 Peer A 注册了，但由于网络问题，Peer A 暂时无法将信息同步给 Peer B。此时 Peer A 和 Peer B 的注册表就是不一致的。</li><li><strong>客户端缓存：</strong> Eureka Client 定期从 Server 获取注册信息并缓存到本地。在 Server 宕机或网络分区时，Client 会使用本地缓存的旧数据进行服务发现，即使这些数据可能不是最新的（包含已下线实例）。这保证了在 Server 不可用时客户端依然能够发现服务（尽管可能发现不准确）。</li></ul></li><li><strong>“自我保护模式”：</strong> 当 Eureka Server 在短时间内丢失大量服务实例的心跳时（可能由于网络问题而非服务实例真的都宕机了），Server 会进入自我保护模式。在这个模式下，Server 不会轻易剔除那些没有按时发送心跳的服务实例，以避免因网络暂时故障导致大量服务被错误地剔除。这进一步体现了 Eureka 对可用性的偏好。</li><li><strong>对比 CP 系统：</strong> Zookeeper 等 CP 系统在网络分区发生时，为了保证数据一致性，通常会停止对外的服务（写操作），直到分区恢复或选出新的 Leader，此时系统在分区期间是不可用的。Eureka 在同样情况下，仍然对外提供服务（可能返回旧数据），保证了可用性。</li></ul></li></ol><h3 id="eureka-工作流程" tabindex="-1"><a class="header-anchor" href="#eureka-工作流程"><span>Eureka 工作流程</span></a></h3><p>理解 Eureka Server 和 Client 的交互流程，是理解其工作方式的关键。</p><ol><li><p><strong>服务注册 (Registration)：</strong></p><ul><li>微服务启动时，Eureka Client 向 Eureka Server 发送 HTTP POST 请求 <code>/eureka/v2/apps/应用名称</code>，请求体包含该服务实例的详细信息（如实例 ID、IP、端口、元数据等）。</li><li>Eureka Server 接收请求，将实例信息添加到内存注册表中。</li></ul></li><li><p><strong>心跳续约 (Renewal)：</strong></p><ul><li>微服务启动后，Eureka Client 定期（默认每 30 秒）向 Eureka Server 发送 HTTP PUT 请求 <code>/eureka/v2/apps/应用名称/实例ID</code>。</li><li>Eureka Server 接收请求，更新该实例的租约（Lease）时间戳。</li><li>如果 Server 在一定时间内（默认 90 秒，可配置 <code>eureka.instance.lease-renewal-interval-in-seconds</code> 和 <code>eureka.instance.lease-expiration-duration-in-seconds</code>）没有收到心跳，则认为该实例已宕机，进入剔除流程。</li></ul></li><li><p><strong>服务发现/获取注册列表 (Discovery/Fetching Registry)：</strong></p><ul><li>服务消费者微服务（Eureka Client）启动时或定期（默认每 30 秒）向 Eureka Server 发送 HTTP GET 请求 <code>/eureka/v2/apps</code> 或 <code>/eureka/v2/apps/应用名称</code>。</li><li>Eureka Server 返回完整的服务注册表信息或指定应用的服务实例列表。</li><li><strong>重要：</strong> Eureka Client 接收到注册表信息后，会<strong>更新到本地缓存</strong>。后续所有的服务发现请求都优先查询本地缓存。</li></ul></li><li><p><strong>客户端缓存的重要性：</strong></p><ul><li>本地缓存是 Eureka AP 特性的关键支撑。</li><li><strong>提升性能：</strong> 减少对 Server 的频繁请求。</li><li><strong>提高可用性：</strong> 即使 Eureka Server 宕机或网络分区，客户端仍然可以使用本地缓存的旧数据进行服务发现，保证了基础可用性（虽然可能调用到已下线实例，但总比完全无法发现服务强）。</li><li>客户端定期（默认每 30 秒）从 Server 获取全量注册表，以保证本地缓存的最终一致性。</li></ul></li><li><p><strong>服务下线 (De-registration)：</strong></p><ul><li>微服务正常关闭时，Eureka Client 向 Eureka Server 发送 HTTP DELETE 请求 <code>/eureka/v2/apps/应用名称/实例ID</code>。</li><li>Eureka Server 接收请求，立即将该实例从注册表中移除。</li><li>如果服务非正常宕机，没有发送下线请求，Server 会通过心跳剔除机制将其移除。</li></ul></li></ol><h3 id="spring-cloud-集成-eureka-的使用方式" tabindex="-1"><a class="header-anchor" href="#spring-cloud-集成-eureka-的使用方式"><span>Spring Cloud 集成 Eureka 的使用方式</span></a></h3><p>Spring Cloud Netflix 项目提供了对 Eureka 的便捷集成，通过 Starter 和注解，可以轻松构建 Eureka Server 和 Client。</p><h4 id="构建-eureka-server" tabindex="-1"><a class="header-anchor" href="#构建-eureka-server"><span>构建 Eureka Server</span></a></h4><ol><li><strong>创建 Spring Boot 项目：</strong> 使用 Spring Initializr 或手动创建一个标准的 Spring Boot 项目。</li><li><strong>添加依赖：</strong> 在 <code>pom.xml</code> 或 <code>build.gradle</code> 中添加 Spring Cloud Eureka Server Starter。<div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>启用 Eureka Server：</strong> 在 Spring Boot 应用的启动类上添加 <code>@EnableEurekaServer</code> 注解。<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaServer</span> <span class="token comment">// 启用 Eureka Server 功能</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EurekaServerApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EurekaServerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>配置 Eureka Server：</strong> 在 <code>application.yml</code> 或 <code>application.properties</code> 中进行基本配置。Eureka Server 默认运行在 8761 端口。<div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># application.yml for Eureka Server</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8761</span>

<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost <span class="token comment"># 单机模式下使用 localhost</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token comment"># 表示不向注册中心注册自己 (Eureka Server 自己也是一个 Spring Boot 应用)</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token comment"># 表示不从注册中心获取服务列表 (Eureka Server 自己的职责是维护列表)</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">serviceUrl</span><span class="token punctuation">:</span>
      <span class="token comment"># 设置服务注册中心的地址，defaultZone 是默认区域</span>
      <span class="token comment"># 如果是单机模式，指向自己</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>eureka.instance.hostname<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>/eureka/

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>构建高可用的 Eureka Server 集群：</strong> 部署多个 Eureka Server 实例，并让它们互相注册。每个 Server 的 <code>defaultZone</code> 都指向集群中所有 Peer Server 的地址列表。<div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># application.yml for Eureka Server (Peer 1)</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8761</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> peer1 <span class="token comment"># Server 1 的主机名</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 作为 Client 注册到其他 Server</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 作为 Client 获取其他 Server 的列表</span>
    <span class="token key atrule">serviceUrl</span><span class="token punctuation">:</span>
      <span class="token comment"># 指向集群中的其他 Peer Server 地址列表</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//peer2<span class="token punctuation">:</span>8762/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//peer3<span class="token punctuation">:</span>8763/eureka/
<span class="token punctuation">---</span> <span class="token comment"># 使用 Spring Profile 分割配置</span>
<span class="token comment"># application.yml for Eureka Server (Peer 2)</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">activate</span><span class="token punctuation">:</span>
      <span class="token key atrule">on-profile</span><span class="token punctuation">:</span> peer2 <span class="token comment"># 使用 profile 激活此配置</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8762</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> peer2 <span class="token comment"># Server 2 的主机名</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">serviceUrl</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//peer1<span class="token punctuation">:</span>8761/eureka/<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//peer3<span class="token punctuation">:</span>8763/eureka/
<span class="token comment"># ... Peer 3 类似配置</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>启动时通过 <code>-Dspring.profiles.active=peer1</code> 等参数激活对应配置。需要配置主机名解析或使用 IP 地址。</li></ol><h4 id="构建-eureka-client-微服务" tabindex="-1"><a class="header-anchor" href="#构建-eureka-client-微服务"><span>构建 Eureka Client (微服务)</span></a></h4><ol><li><strong>创建 Spring Boot 项目：</strong> 标准微服务项目。</li><li><strong>添加依赖：</strong> 在 <code>pom.xml</code> 或 <code>build.gradle</code> 中添加 Spring Cloud Eureka Client Starter。<div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-ribbon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>启用 Eureka Client：</strong> 在微服务的启动类上添加 <code>@EnableDiscoveryClient</code> (Spring Cloud 通用) 或 <code>@EnableEurekaClient</code> (特定于 Eureka)。<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span> <span class="token comment">// 启用服务发现客户端功能</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMicroserviceApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyMicroserviceApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><strong>配置 Eureka Client：</strong> 在 <code>application.yml</code> 或 <code>application.properties</code> 中进行配置。<div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token comment"># application.yml for Eureka Client</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>service <span class="token comment"># 微服务的应用名称，注册到 Eureka 后将以此名称被发现</span>

<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token comment"># 表示向注册中心注册自己 (Eureka Client 的默认行为是 true)</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># 表示从注册中心获取服务列表 (Eureka Client 的默认行为是 true)</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">serviceUrl</span><span class="token punctuation">:</span>
      <span class="token comment"># 指向 Eureka Server 的地址，如果集群，列出所有 Peer 的地址</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8761/eureka/ <span class="token comment"># 单机指向本地 Server</span>
      <span class="token comment"># defaultZone: http://peer1:8761/eureka/,http://peer2:8762/eureka/ # 集群指向 Peer 列表</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token comment"># 推荐使用 IP 地址注册，防止主机名解析问题</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># 也可以自定义实例 ID，默认是 hostname:应用名:端口</span>
    <span class="token comment"># instance-id: ${spring.cloud.client.ip-address}:${server.port}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="在客户端进行服务发现与调用" tabindex="-1"><a class="header-anchor" href="#在客户端进行服务发现与调用"><span>在客户端进行服务发现与调用</span></a></h4><p>微服务作为服务消费者时，可以利用 <code>DiscoveryClient</code> 或结合负载均衡器来发现和调用服务：</p><ol><li><p><strong>使用 <code>DiscoveryClient</code>：</strong> 注入 <code>DiscoveryClient</code> Bean，通过服务名称获取服务实例列表。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">callMyService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取 my-service 的所有可用实例</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">&quot;my-service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instances <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>instances<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 通常这里会结合负载均衡策略选择一个实例</span>
            <span class="token class-name">ServiceInstance</span> instance <span class="token operator">=</span> instances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 简化，直接取第一个</span>
            <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;http://&quot;</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/some/endpoint&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">// 使用 RestTemplate 或 WebClient 调用</span>
            <span class="token comment">// restTemplate.getForObject(url, String.class);</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>使用 <code>@LoadBalanced</code> <code>RestTemplate</code> 或 <code>WebClient</code> (更推荐)：</strong> 这是 Spring Cloud 集成 Ribbon/LoadBalancer 后的便捷方式。只需要在 <code>RestTemplate</code> 或 <code>WebClient.Builder</code> Bean 上添加 <code>@LoadBalanced</code> 注解，然后调用时直接使用<strong>服务名称</strong>代替主机名和端口。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestClientConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span> <span class="token comment">// 开启负载均衡功能</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 或 WebClient</span>
    <span class="token comment">// @Bean</span>
    <span class="token comment">// @LoadBalanced</span>
    <span class="token comment">// public WebClient.Builder webClientBuilder() {</span>
    <span class="token comment">//     return WebClient.builder();</span>
    <span class="token comment">// }</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span> <span class="token comment">// 注入 @LoadBalanced 的 RestTemplate</span>

    <span class="token comment">// 或 @Autowired WebClient.Builder webClientBuilder;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">callMyService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 直接使用服务名称 &quot;my-service&quot;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;http://my-service/some/endpoint&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// webClientBuilder.build().get().uri(&quot;lb://my-service/some/endpoint&quot;).retrieve().bodyToMono(String.class).block(); // lb:// 标识使用 LoadBalancer</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Call result: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时，<code>@LoadBalanced</code> 拦截器会结合 LoadBalancer/Ribbon 和 DiscoveryClient，在实际发起请求前，根据服务名称查找对应的服务实例列表，并应用负载均衡策略选择一个实例的实际地址进行调用。</p></li></ol><h4 id="eureka-重要配置项解析" tabindex="-1"><a class="header-anchor" href="#eureka-重要配置项解析"><span>Eureka 重要配置项解析</span></a></h4><ul><li><code>eureka.client.serviceUrl.defaultZone</code>: 服务注册和发现的地址，可以是单个地址或地址列表（用于高可用）。</li><li><code>eureka.instance.hostname</code>: 服务实例注册时使用的主机名，默认是机器名。</li><li><code>eureka.instance.instance-id</code>: 服务实例的唯一 ID，默认是 <code>${spring.cloud.client.hostname}:${spring.application.name}:${server.port}</code>，可以自定义。</li><li><code>eureka.instance.prefer-ip-address</code>: 注册时优先使用 IP 地址而不是主机名（推荐在容器或云环境中使用）。</li><li><code>eureka.client.register-with-eureka</code>: 当前应用是否应该向 Eureka Server 注册自己（Eureka Server 本身应设为 <code>false</code>）。</li><li><code>eureka.client.fetch-registry</code>: 当前应用是否应该从 Eureka Server 获取注册信息（Eureka Server 本身应设为 <code>false</code>）。</li><li><code>eureka.instance.lease-renewal-interval-in-seconds</code>: Eureka Client 发送心跳续约的间隔（秒），默认 30。</li><li><code>eureka.instance.lease-expiration-duration-in-seconds</code>: Eureka Server 多久没有收到心跳就认为实例宕机（秒），默认 90。</li></ul><h3 id="理解-eureka-架构与使用方式的价值" tabindex="-1"><a class="header-anchor" href="#理解-eureka-架构与使用方式的价值"><span>理解 Eureka 架构与使用方式的价值</span></a></h3><ul><li><strong>解决服务发现核心问题：</strong> 掌握微服务如何动态注册和查找。</li><li><strong>构建高可用注册中心：</strong> 理解 Peer-to-Peer 复制如何提升 Eureka Server 的可用性。</li><li><strong>理解 CAP 理论取舍：</strong> 了解 Eureka 为何选择 AP 以及客户端缓存为何重要。</li><li><strong>高效排查注册/发现问题：</strong> 知道注册失败、发现不到服务、或发现到已下线服务可能的原因（配置错误、网络、心跳、剔除机制、客户端缓存）。</li><li><strong>应对面试：</strong> 服务发现是微服务核心，Eureka 是经典案例。</li></ul><h3 id="eureka-为何是面试热点" tabindex="-1"><a class="header-anchor" href="#eureka-为何是面试热点"><span>Eureka 为何是面试热点</span></a></h3><ul><li><strong>微服务基础设施：</strong> 服务发现是构建微服务的基础，理解它是必备技能。</li><li><strong>经典实现案例：</strong> Eureka 是服务发现领域的经典代表，其设计思想具有代表性。</li><li><strong>CAP 理论应用：</strong> Eureka 对 AP 的选择是 CAP 理论在实际系统中的一个典型应用，面试官常用来考察理论与实践结合。</li><li><strong>高可用设计：</strong> Peer-to-Peer 复制是其高可用设计的核心，也是考察点。</li><li><strong>Spring Cloud 集成：</strong> 如何结合 Spring Boot/Cloud 使用 Eureka 是考察实践能力。</li></ul><h3 id="面试问题示例与深度解析" tabindex="-1"><a class="header-anchor" href="#面试问题示例与深度解析"><span>面试问题示例与深度解析</span></a></h3><ul><li><strong>什么是服务发现？为什么微服务需要服务发现？</strong> (定义，解释服务动态性带来的挑战)</li><li><strong>请描述一下 Netflix Eureka 的架构。它包含哪些核心组件？</strong> (Server, Client, Peer-to-Peer 复制，各自职责)</li><li><strong>Eureka Server 集群如何实现高可用？请简述 Peer-to-Peer 复制的原理。</strong> (Server 互相注册，异步复制，定期拉取同步)</li><li><strong>请描述一个服务实例从启动到被其他服务发现的完整流程。</strong> (Client 注册 -&gt; Server 注册表 -&gt; Server Peer 复制 -&gt; Client 定期获取 -&gt; Client 本地缓存 -&gt; Consumer Client 从缓存获取)</li><li><strong>Eureka Client 为什么需要本地缓存？它的作用是什么？</strong> (提升性能，关键在于提高可用性，Server 宕机时仍可用)</li><li><strong>Eureka 在 CAP 定理中是如何取舍的？它选择了 AP 还是 CP？为什么？</strong> (选择了 AP，解释可用性优先，网络分区时仍可对外提供服务，客户端缓存是支撑 AP 的关键)</li><li><strong>什么是 Eureka 的自我保护模式？它有什么用？</strong> (短时丢失大量心跳时不剔除实例，防止网络故障导致服务被误删，牺牲一致性保可用性)</li><li><strong>在 Spring Cloud 中，如何搭建 Eureka Server 和 Client？需要哪些依赖和注解？</strong> (Server: <code>spring-cloud-starter-netflix-eureka-server</code>, <code>@EnableEurekaServer</code>；Client: <code>spring-cloud-starter-netflix-eureka-client</code>, <code>@EnableDiscoveryClient</code>/@EnableEurekaClient；配置 <code>serviceUrl</code>)</li><li><strong>如何在高可用模式下配置 Eureka Server 集群？</strong> (多个 Server，互相指向对方的 <code>defaultZone</code>)</li><li><strong>如何在 Spring Cloud Eureka Client 中发现并调用其他服务？常用的方式有哪些？</strong> (<code>DiscoveryClient</code> 或 <code>@LoadBalanced</code> <code>RestTemplate</code>/<code>WebClient</code>，说明后者的便捷性)</li></ul><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>Eureka 作为 Spring Cloud 生态中经典的服务发现组件，通过其 Client-Server 架构、Peer-to-Peer 的高可用复制、以及对 CAP 定理 AP 原则的实践，为微服务提供了稳定可靠的服务注册和发现能力。</p><p>理解 Eureka 的架构（Server, Client, Peer 复制）、核心工作流程（注册、心跳、发现、缓存、剔除）以及它在 CAP 定理下的权衡，是掌握服务发现这一微服务核心模式的关键。结合 Spring Cloud Starter 和注解，我们可以轻松地在应用中集成 Eureka。</p><p>尽管 Eureka 进入了维护模式，但其设计思想和服务发现的核心原理依然是分布式系统学习的重要内容，也是衡量微服务开发能力的重要面试考点。</p></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/springcloud/springcloud-eureka.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: oointer@163.com">Yideng</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/javabaguwen/springcloud/springcloud-select.html" aria-label="SpringCloud体系架构选型"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->SpringCloud体系架构选型</div></a><a class="route-link nav-link next" href="/javabaguwen/springcloud/springcloud-feign.html" aria-label="open feign架构设计"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">open feign架构设计<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2025 Mr.Hope </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/javabaguwen/assets/app-CzKZ5RuK.js" defer></script>
  </body>
</html>
